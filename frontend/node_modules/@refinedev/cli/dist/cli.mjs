#!/usr/bin/env node
var Pr=Object.defineProperty;var I=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var xr=(e,t)=>{for(var r in t)Pr(e,r,{get:t[r],enumerable:!0})};import{Command as ps}from"commander";import ms from"figlet";import $ from"chalk";import Re from"center-align";import Ir from"ora";var Er=async(e,t)=>{let r=Ir({color:"cyan",text:t}).start(),o=await e();return r.stop(),o},k=Er;import se from"execa";import{existsSync as Rr,pathExists as He,readFileSync as Tr,readJSON as Cr}from"fs-extra";import kr from"globby";import Je from"path";import br from"preferred-pm";var D=()=>{if(!Rr("package.json"))throw console.error("\u274C `package.json` not found."),new Error("./package.json not found");return JSON.parse(Tr("package.json","utf8"))},_=()=>{let e=D();return Object.keys(e.dependencies||{})},Ye=()=>{let e=D();return(e==null?void 0:e.dependencies)||{}},Ke=()=>{let e=D();return Object.keys(e.devDependencies||{})},Sr=()=>[..._(),..._()],ie=()=>{let e=D();return(e==null?void 0:e.scripts)||{}},V=async()=>{var e;try{let t=await se("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},o=Object.keys(r).filter(s=>s.startsWith("@refinedev")||s.startsWith("@pankod/refine-")),n=[];for(let s of o){let i=r[s].version;n.push({name:s,version:i})}return n}catch{return Promise.resolve(null)}},G=async()=>{let e=["ably","airtable","antd","appwrite","chakra-ui","codemod","core","devtools","devtools-internal","devtools-server","devtools-shared","devtools-ui","graphql","hasura","inferencer","kbar","mantine","medusa","mui","nestjs-query","nestjsx-crud","nextjs-router","react-hook-form","react-router","react-router-v6","react-table","remix-router","shared","simple-rest","strapi","strapi-v4","supabase"];try{let t=await kr("node_modules/@refinedev/*",{onlyDirectories:!0}),r=e.flatMap(n=>{try{let s=I.resolve(Je.join("@refinedev",n,"package.json"));return[Je.dirname(s)]}catch{return[]}}),o=[];return await Promise.all([...r,...t].map(async n=>{if(await He(`${n}/package.json`)){let i=await Cr(`${n}/package.json`);o.push({name:i.name,version:i.version,path:n})}})),o}catch{return[]}},Ge=async e=>await He(`${e}/refine.config.js`),N={npm:{add:["install","--save"],addDev:["install","--save-dev"],outdatedJson:["outdated","--json"],install:["install"]},yarn:{add:["add"],addDev:["add","-D"],outdatedJson:["outdated","--json"],install:["install"]},pnpm:{add:["add"],addDev:["add","-D"],outdatedJson:["outdated","--format","json"],install:["install"]},bun:{add:["add"],addDev:["add","--dev"],outdatedJson:["outdated","--format","json"],install:["install"]}},C=async()=>{let e=await k(()=>br(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},L=async(e,t="all",r="All `Refine` packages updated  \u{1F389}")=>{let o=await C();try{let n=t==="all"?N[o.name].install:N[o.name].add,s=se(o.name,[...n,...e],{stdio:"inherit"});s.on("message",i=>{console.log(i)}),s.on("error",i=>{console.log(i)}),s.on("exit",i=>{if(i===0){console.log(r);return}console.log(`Application exited with code ${i}`)})}catch(n){throw new Error(n)}},xe=async e=>{let t=await C();try{let r=N[t.name].add,o=se.sync(t.name,[...r,...e],{stdio:"inherit"});if(o.failed||o.exitCode!==0)throw new Error(o.stderr);return o}catch(r){throw new Error(r)}},Ie=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}},Ze=()=>{var t;let e=D();return(t=e==null?void 0:e.refine)==null?void 0:t.projectId},ae=async()=>(await G()).some(t=>t.name==="@refinedev/devtools"),Nr=e=>{let t=_();return e.filter(r=>!t.includes(r))},Qe=async e=>{console.log("\u{1F331} Checking dependencies...");let t=Nr(e);t.length>0?(console.log(`\u{1F331} Installing ${t.join(", ")}`),await xe(t),console.log("\u{1F389} Installation complete...")):console.log("\u{1F389} All required packages are already installed")},et=e=>{let t=Sr(),r=e.filter(o=>t.includes(o));return r.length>0?(console.log(`\u{1F6A8} This feature doesn't support ${r.join(", ")} package.`),!0):!1},tt=async e=>{let t="npm",{stdout:r,timedOut:o}=await se(t,["view",e,"versions","--json"],{reject:!1,timeout:25e3});o&&(console.log("\u274C Timed out while checking for updates."),process.exit(1));let n=[];try{n=JSON.parse(r),(!n||"error"in n)&&(console.log("\u274C Something went wrong while checking for updates."),process.exit(1))}catch{console.log("\u274C Something went wrong while checking for updates."),process.exit(1)}return n},rt=async e=>{let t=await V();return t?t.some(r=>r.name===e):!1};import Dr from"cli-table3";import ce from"chalk";var ot=e=>e.charAt(0).toUpperCase()+e.slice(1),nt=e=>e.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"");var Z={name:"name",current:"current",wanted:"wanted",latest:"latest",changelog:"changelog"},Ee=[Z.name,Z.current,Z.wanted,Z.latest,Z.changelog],le=(e=[])=>{var P;let t=Object.keys((e==null?void 0:e[0])||{});if(!e||!t.length)return{table:"",width:0};let r=process.stdout.columns||80,o=Math.max(...e.map(m=>m.name.length))+2,n=7+2,s=6,i=Math.min(35,r-o-n*3-s),l={name:o,current:n,wanted:n,latest:n,changelog:i},u=new Dr({head:Ee,wordWrap:!1,wrapOnWordBoundary:!0,colWidths:Ee.map(m=>l[m]),style:{head:["blue"]}}),a=(m,c)=>{if(m.length>c){let p=c-3,f=m.slice(0,Math.floor(p/2)),v=m.slice(-Math.ceil(p/2));return`${f}...${v}`}return m};e.forEach(m=>{u.push(Ee.map(c=>{let p=m[c];if(!p)return p;if(c==="latest"||c==="wanted"){let f=st(m.current),v=st(p),w=Ar(f,v),S=ce[w.major](v.major),x=ce[w.minor](v.minor),O=ce[w.patch](v.patch);return`${S}.${x}.${O}`}return c==="changelog"?ce.blueBright.underline(p):p}))});let d=u.toString(),h=nt(((P=d.split(`
`))==null?void 0:P[0])||"").length;return{table:d,width:h}},st=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},Ar=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"};var pe=async e=>{let t=e==null?void 0:e.data,r=Object.keys((t==null?void 0:t[0])||{});if(!t||!r.length)return;let{table:o,width:n}=le(t);console.log(),console.log(Re("Update Available",n)),console.log(),console.log(`- ${$.yellow($.bold("Current"))}: The version of the package that is currently installed`),console.log(`- ${$.yellow($.bold("Wanted"))}: The maximum version of the package that satisfies the semver range specified in \`package.json\``),console.log(`- ${$.yellow($.bold("Latest"))}: The latest version of the package available on npm`),console.log(o),console.log(Re(`To update ${$.bold("`Refine`")} packages with wanted version`,n)),console.log(Re(` Run the following command: ${$.yellowBright(await jr())}`,n)),console.log()},jr=async()=>{let e="npx @refinedev/cli update",t=_(),r=Object.keys(ie()),o=t.includes("@refinedev/cli"),n=r.includes("refine");if(!o&&!n)return e;let s=await C();return n?`${s.name} run refine update`:o?"npx refine update":e};import Or from"execa";import _r from"semver-diff";import{maxSatisfying as $r}from"semver";var Fr=e=>e.command("check-updates").description("Check all installed `Refine` packages are up to date").action(Vr),Vr=async()=>{let e=await k(Q,"Checking for updates...");if(!e.length){console.log("All `Refine` packages are up to date \u{1F389}\n");return}await pe({data:e})},Q=async()=>await Mr(),Mr=async()=>{let e=await Ur();if(!e)return[];let t=[];return Object.keys(e).forEach(o=>{let n=e[o];o.includes("@refinedev")&&t.push({...n,name:o,changelog:o.replace(/@refinedev\//,"https://c.refine.dev/")})}),t.filter(o=>!!_r(o.current,o.latest))},Ur=async()=>{let e="npm",{stdout:t,timedOut:r}=await Or(e,N[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},it=(e,t)=>{let o=Ye()[e];return o?o==="latest"?"latest":o==="*"?"*":[">","<",">=","<=","||"].some(n=>o.includes(n))?o:o!=null&&o.includes("x")?`${o}`:o!=null&&o.startsWith("~")?`~${t}`:o!=null&&o.startsWith("^")?`^${t}`:t:`^${t}`},at=async(e,t)=>{let r=await tt(e);return $r(r,`^${t}`)??t},ct=Fr;var y=(a=>(a.REACT_SCRIPT="react-scripts",a.REMIX="remix",a.REMIX_VITE="remix-vite",a.REMIX_SPA="remix-spa",a.NEXTJS="nextjs",a.VITE="vite",a.CRACO="craco",a.PARCEL="parcel",a.UNKNOWN="unknown",a))(y||{});var Te=(n=>(n.ANTD="antd",n.MUI="mui",n.MANTINE="mantine",n.CHAKRA="chakra-ui",n))(Te||{});var lt=(o=>(o.NPM="npm",o.YARN="yarn",o.PNPM="pnpm",o))(lt||{});var g=e=>{if(e)return e;let t=[],r=[];try{t=_(),r=Ke()}catch{}return t.includes("@craco/craco")||r.includes("@craco/craco")?"craco":t.includes("react-scripts")||r.includes("react-scripts")?"react-scripts":t.includes("next")||r.includes("next")?"nextjs":t.includes("@remix-run/react")||r.includes("@remix-run/react")?t.includes("vite")||r.includes("vite")?"remix-vite":"remix":t.includes("vite")||r.includes("vite")?"vite":t.includes("parcel")||r.includes("parcel")?"parcel":"unknown"},pt=()=>{let e=_();if(e.includes("@refinedev/antd"))return"antd";if(e.includes("@refinedev/mui"))return"mui";if(e.includes("@refinedev/chakra-ui"))return"chakra-ui";if(e.includes("@refinedev/mantine"))return"mantine"},mt=e=>{switch(e){case"react-scripts":return"REACT_APP_REFINE_DEVTOOLS_PORT";case"nextjs":return"NEXT_PUBLIC_REFINE_DEVTOOLS_PORT";case"vite":return"VITE_REFINE_DEVTOOLS_PORT";default:return"REFINE_DEVTOOLS_PORT"}};import Br from"camelcase";var ee=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":case"remix-vite":case"remix-spa":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},dt=e=>{switch(e){case"nextjs":return{path:"src/providers",alias:"../src/providers"};case"remix":case"remix-vite":case"remix-spa":return{path:"app/providers",alias:"~/providers"}}return{path:"src/providers",alias:"providers"}},me=e=>{switch(e){case"remix":case"remix-vite":case"remix-spa":return"./app";default:return"./src"}},ut=e=>Br(e,{preserveConsecutiveUppercase:!0,pascalCase:!0});import M from"handlebars";import{readFileSync as Lr,readdirSync as Wr,createFileSync as zr,writeFileSync as Xr,unlinkSync as qr}from"fs-extra";var Jr=(e,t)=>{let r=Lr(e);return M.registerHelper("ifIn",(n,s,i)=>n.includes(s)?i.fn(M):i.inverse(M)),M.registerHelper("formatInferencerComponent",n=>{if(n)switch(n){case"chakra-ui":return"ChakraUI";default:return n.charAt(0).toUpperCase()+n.slice(1)}}),M.registerHelper("capitalize",n=>{if(n)return n.charAt(0).toUpperCase()+n.slice(1)}),M.registerHelper("getComponentNameByResource",n=>{if(n)return ut(n)}),M.compile(r.toString())(t)},Ce=(e,t)=>{Wr(e,{recursive:!0}).forEach(o=>{if(typeof o!="string"||!o.endsWith(".hbs"))return;let n=`${e}/${o}`,s=`${e}/${o.replace(".hbs","")}`;zr(s),Xr(s,Jr(n,t)),qr(n)})};import Hr from"execa";import{copySync as gt,mkdirSync as ht,moveSync as Yr,pathExistsSync as ft,unlinkSync as Kr}from"fs-extra";import Gr from"inquirer";import{join as re}from"path";import{plural as Zr}from"pluralize";import ke from"temp";var te=["list","create","edit","show"],W=async(e,t)=>{var s;let r=(e==null?void 0:e.path)||ee(g()).path,o=e.actions||te.join(",");if(!t.length){let{name:i,selectedActions:l}=await Gr.prompt([{type:"input",name:"name",message:"Resource Name (users, products, orders etc.)",validate:u=>u?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:te,default:(s=e==null?void 0:e.actions)==null?void 0:s.split(",")}]);t=[i],o=l.join(",")}let n=!1;t.forEach(i=>{let l=o?o.split(","):void 0,u=Zr(i).toLowerCase(),a=re(process.cwd(),r,u);if(ft(a)){console.error(`\u274C Resource (${re(r,u)}) already exist!`);return}n=!0;let d=ot(i),h=pt(),m=g()==="nextjs",c=`${be()}/../templates/resource/components`,p=Qr();gt(c,p);let f={resourceName:i,resource:d,actions:l||te,uiFramework:h,isNextJs:m};Ce(p,f),l&&te.forEach(O=>{l.includes(O)||Kr(`${p}/${O}.tsx`)}),ht(r,{recursive:!0});let v=`${r}/${u}`,w={};ft(v)&&(w={overwrite:!0}),Yr(p,v,w),ke.cleanupSync(),m&&eo(d,u,l||te);let S=I.resolve(".bin/jscodeshift"),{stderr:x}=Hr.sync(S,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${be()}/../src/transformers/resource.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist",`--__actions=${f.actions}`,`--__pathAlias=${ee(g()).alias}`,`--__resourceFolderName=${u}`,`--__resource=${d}`,`--__resourceName=${i}`]);x&&console.log(x),console.log(`\u{1F389} Resource (${v}) generated successfully!`)}),n&&to()},be=()=>__dirname,Qr=()=>(ke.track(),ke.mkdirSync("resource")),eo=(e,t,r)=>{let o=re(process.cwd(),"src/app/",t),n={list:"/",create:"/create",edit:"/edit/[id]",show:"/show/[id]"};r.forEach(i=>{let l=n[i],u=re(o,l);ht(u,{recursive:!0});let a=`${be()}/../templates/resource/pages/next/${l}/page.tsx.hbs`,d=re(u,"page.tsx.hbs");gt(a,d)}),Ce(o,{resource:e,resourceFolderName:t})},to=async()=>{console.log(),await k(()=>rt("@refinedev/inferencer"),"Checking if '@refinedev/inferencer' package is installed...")||(console.log("\u{1F4E6} Installing '@refinedev/inferencer' package..."),await L(["@refinedev/inferencer@latest"],"add","\u2705 '@refinedev/inferencer' package installed successfully!"))};var ro=e=>{let t=g(),{path:r}=ee(t);return e.command("create-resource").allowExcessArguments(!0).description('Create a new resource files (deprecated, please use "add resource" command)').option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(oo)},oo=async(e,t)=>{W(e,t.args)},vt=ro;import{Option as ho}from"commander";import io from"conf";import ao from"chalk";import*as yt from"dotenv";var wt={};yt.config({processEnv:wt});var no={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},so=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,o]of Object.entries(no))if(o.test(e)){t=r;break}return t},de=e=>process.env[e]||wt[e],b={NODE_ENV:so(),REFINE_NO_TELEMETRY:de("REFINE_NO_TELEMETRY")||"false",UPDATE_NOTIFIER_IS_DISABLED:de("UPDATE_NOTIFIER_IS_DISABLED")||"false",UPDATE_NOTIFIER_CACHE_TTL:de("UPDATE_NOTIFIER_CACHE_TTL")||1e3*60*60*24,REFINE_DEVTOOLS_PORT:de("REFINE_DEVTOOLS_PORT")};var Pt=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var co="refine-update-notifier",A=new io({projectName:co,defaults:{key:"",lastUpdated:0,packages:[]}}),z=async()=>{if(fo())return;let e=await po();if(e!==null){if(e){xt();return}lo(),xt()}},lo=async()=>{let e=A.get("packages");e!=null&&e.length&&(await pe({data:e}),console.log(`
`))},po=async()=>{let e=await uo(),t=mo();return e===null?null:!!(t||!e)},xt=async()=>{try{let e=await Q();return A.set("packages",e),A.set("lastUpdated",Date.now()),A.set("key",await It()),e}catch{return A.set("packages",[]),A.set("lastUpdated",Date.now()),A.set("key",""),null}},mo=()=>{let e=A.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,o=Number(b.UPDATE_NOTIFIER_CACHE_TTL);return r>=o},uo=async()=>{let e=A.get("key"),t=await It();return t===null?null:e===t},It=async()=>{let e=await V();if(!e)return console.error(ao.red("Something went wrong when trying to get installed `Refine` packages.")),null;let t=e.map(o=>`${o.name}@${o.version}`);return Pt(t.toString())},fo=()=>b.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";function F(e){if(process.platform==="win32")try{return I.resolve(`.bin/${e}.exe`)}catch{}return I.resolve(`.bin/${e}`)}var R={["react-scripts"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>F("react-scripts")},["vite"]:{getDev:e=>["dev",...e],getStart:e=>["preview",...e],getBuild:e=>["build",...e],getBin:()=>F("vite")},["nextjs"]:{getDev:e=>["dev",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>F("next")},["remix"]:{getDev:e=>["dev",...e],getStart:e=>(e==null?void 0:e.length)?e:(console.log(),console.warn("\u{1F6A8} Remix requires a path to the entry file. Please provide it as an argument to `refine start` command in package.json scripts"),console.warn("Refine will use `./build/index.js` as default"),console.warn("Example: `refine start ./build/index.js`"),console.log(),["./build/index.js"]),getBuild:e=>["build",...e],getBin:e=>F(e==="start"?"remix-serve":"remix")},["remix-vite"]:{getDev:e=>["vite:dev",...e],getStart:e=>(e==null?void 0:e.length)?e:(console.log(),console.warn("\u{1F6A8} Remix requires a path to the entry file. Please provide it as an argument to `refine start` command in package.json scripts"),console.warn("Refine will use `./build/server/index.js` as default"),console.warn("Example: `refine start ./build/server/index.js`"),console.log(),["./build/server/index.js"]),getBuild:e=>["vite:build",...e],getBin:e=>F(e==="start"?"remix-serve":"remix")},["remix-spa"]:{getDev:e=>["vite:dev",...e],getStart:e=>["preview",...e],getBuild:e=>["vite:build",...e],getBin:e=>F(e==="start"?"vite":"remix")},["craco"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>F("craco")},["parcel"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>F("parcel")},["unknown"]:{getDev:e=>[...e],getStart:e=>[...e],getBuild:e=>[...e],getBin:()=>"unknown"}};import go from"execa";var j=async(e,t,r={})=>{var n,s;if(e==="unknown"){let i=Object.values(y).filter(l=>l!=="unknown").join(", ");console.error(`We couldn't find executable for your project. Supported executables are ${i}.
Please use your own script directly. If you think this is an issue, please report it at: https://github.com/refinedev/refine/issues`);return}let o=go(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",REFINE_NO_TELEMETRY:b.REFINE_NO_TELEMETRY,...r,...process.env}});return(n=o.stdout)==null||n.pipe(process.stdout),(s=o.stderr)==null||s.pipe(process.stderr),await o};var X=e=>{let t=g(),r=[];switch(e){case"dev":r=R[t].getDev([""]);break;case"start":r=R[t].getStart([""]);break;case"build":r=R[t].getBuild([""]);break}if(e==="start")switch(t){case"remix":case"remix-vite":t="remix-serve";break;case"remix-spa":t="vite";break}return`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`},q=()=>`Platform to run command on. 
ex: ${Object.values(y).join(", ")}`;var vo=e=>e.command("start").description(X("start")).allowUnknownOption(!0).addOption(new ho("-p, --platform <platform>",q()).choices(Object.values(y).filter(t=>t!=="unknown"))).argument("[args...]").action(yo),yo=async(e,{platform:t})=>{let r=g(t),o=R[r].getBin("start"),n=R[r].getStart(e);await z(),j(o,n)},Se=vo;import{Option as St}from"commander";import{server as Io}from"@refinedev/devtools-server";import xo from"execa";import{format as wo,resolveConfig as Po}from"prettier";var Ne=async e=>{try{let t=await Po(process.cwd());return wo(e,{...t??{},parser:"typescript"})}catch{return e}};var Et=async()=>{let e=I.resolve(".bin/jscodeshift"),{stderr:t}=xo.sync(e,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/add-devtools-component.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);t&&console.log(t)};var Rt=()=>{let t=D().scripts||{};return{dev:((t==null?void 0:t.dev)||"").match(/refine dev(\s|$|;){1}/)!==null}};import Eo from"boxen";import Ro from"cardinal";import Tt from"chalk";import{Argument as To}from"commander";import Co from"dedent";import Ae from"semver";var ko=["start","init"],bo="start",Ct="4.42.0",So=e=>e.command("devtools").description("Start or install Refine Devtools server; it starts on port 5001.").addArgument(new To("[command]","devtools related commands").choices(ko).default(bo)).addHelpText("after",`
Commands:
    start     Start Refine Devtools server
    init      Install Refine Devtools client and adds it to your project
`).action(No),No=async e=>{switch(e){case"start":je();return;case"init":Do();return}},Do=async()=>{var n;let e=await De();if(await k(ae,"Checking if devtools is installed...")){console.log("\u{1F389} Refine Devtools is already installed");return}if(e&&await kt({pkg:e}))return;console.log("\u{1F331} Installing Refine Devtools...");let r=["@refinedev/devtools@latest"];if((!e||Ae.lt(e.version,Ct))&&(r.push("@refinedev/core@latest"),console.log("\u{1F331} Refine core package is being updated for devtools...")),await xe(r),console.log(""),console.log(""),console.log("\u{1F331} Adding devtools component to your project...."),await Et(),console.log("\u2705 Refine Devtools package and components added to your project"),r.includes("@refinedev/core@latest")){let s=await De();console.log(`\u2705 Refine core package updated from ${(e==null?void 0:e.version)??"unknown"} to ${(s==null?void 0:s.version)??"unknown"}`),console.log(`   Changelog: ${Tt.underline.blueBright(`https://c.refine.dev/core#${(e==null?void 0:e.version.replaceAll(".",""))??""}`)}`)}console.log("");let{dev:o}=Rt();if(o){console.log(`\u{1F64C} You're good to go. "npm run dev" will automatically starts the devtools server.`),console.log('\u{1F449} You can also start the devtools server manually by running "refine devtools start"');return}if(!o){let s=(n=D().scripts)==null?void 0:n.dev;console.log('\u{1F6A8} Your have modified the "dev" script in your package.json. Because of that, "npm run dev" will not start the devtools server automatically.'),console.log('\u{1F449} You can append "refine devtools" to "dev" script'),console.log('\u{1F449} You can start the devtools server manually by running "refine devtools"'),console.log(""),console.log(Eo(Ro.highlight(Co(`
                {
                    "scripts": {
                        "dev": "${s} & refine devtools",
                        "refine": "refine"
                    }
                }  
        `)),{padding:1,title:"package.json",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"}))}},je=async({exitOnError:e=!0}={})=>{let t=await De();if(t){if(await kt({pkg:t}))return;if(Ae.lt(t.version,Ct)){console.log(`\u{1F6A8} You're using an old version of Refine(${t.version}). Refine version should be @4.42.0 or higher to use devtools.`);let r=await C();console.log(`\u{1F449} You can update @refinedev/core package by running "${r.name} run refine update"`);return}}Io({onError:()=>{e&&process.exit(1)}}).catch(r=>{})},De=async()=>{let e=await G(),t=e==null?void 0:e.find(r=>r.name==="@refinedev/core"||r.name==="@pankod/refine-core");if(t)return t},kt=async({pkg:e})=>e.name==="@pankod/refine-core"||Ae.lt(e.version,"4.0.0")?(console.log(`\u{1F6A8} You're using an old version of Refine(${e.version}). Refine version should be @4.42.0 or higher to use devtools.`),console.log("You can follow migration guide to update Refine."),console.log(Tt.blue("https://refine.dev/docs/migration-guide/3x-to-4x/")),!0):!1,bt=So;var Ao=e=>e.command("dev").description(X("dev")).allowUnknownOption(!0).addOption(new St("-p, --platform <platform>",q()).choices(Object.values(y).filter(t=>t!=="unknown"))).addOption(new St("-d, --devtools <devtools>","Start Refine Devtools server").default("true","true if devtools is installed")).argument("[args...]").action(jo),jo=async(e,{platform:t,...r})=>{let o=g(t),n=R[o].getBin("dev"),s=R[o].getDev(e);await z();let i=mt(o),l=await ae(),u=r.devtools==="false"?!1:l;u&&je({exitOnError:!1});let a=u&&b.REFINE_DEVTOOLS_PORT?{[i]:b.REFINE_DEVTOOLS_PORT}:void 0;j(n,s,a)},Oe=Ao;import{Option as Oo}from"commander";var _o=e=>e.command("build").description(X("build")).allowUnknownOption(!0).addOption(new Oo("-p, --platform <platform>",q()).choices(Object.values(y).filter(t=>t!=="unknown"))).argument("[args...]").action($o),$o=async(e,{platform:t})=>{let r=g(t),o=R[r].getBin("build"),n=R[r].getBuild(e);await z();try{await j(o,n)}catch{process.exit(1)}},_e=_o;import Nt from"chalk";var Fo=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(Vo),Vo=async e=>{let[t,...r]=e,o=ie();if(!t){console.log(`Available via ${Nt.blue("`refine run`")}:
`);for(let[i,l]of Object.entries(o))console.log(`  ${i}`),console.log(`    ${Nt.dim(l)}`),console.log();return}if(!Object.keys(o).includes(t)){let i=`${process.cwd()}/node_modules/.bin/${t}`;j(i,r);return}let s=await C();j(s.name,["run",t,...r])},$e=Fo;import Wt from"path";import H from"chalk";import ge from"inquirer";import nn from"inquirer-autocomplete-prompt";import{ensureFile as sn,pathExists as zt,readFile as an,writeFile as cn}from"fs-extra";import Ft from"path";import Xo from"path";var Fe={};xr(Fe,{PackageManagerTypes:()=>lt,ProjectTypes:()=>y,UIFrameworks:()=>Te,appendAfterImports:()=>Ot,getFileContent:()=>ue,getImports:()=>J,getNameChangeInImport:()=>At});var Mo=/import(?:\s+(type))?\s*(?:([^\s\{\},]+)\s*(?:,\s*)?)?(\{[^}]+\})?\s*(?:\*\s*as\s+([^\s\{\}]+)\s*)?from\s*['"]([^'"]+)['"];?/g,Uo=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,J=e=>{let t=e.matchAll(Mo),r=[];for(let o of t){let[n,s,i,l,u,a]=o;r.push({isType:s==="type",statement:n,importPath:a,...i&&{defaultImport:i},...l&&{namedImports:l},...u&&{namespaceImport:u}})}return r==null?void 0:r.filter(Boolean)},At=e=>{let t=e.matchAll(Uo),r=[];for(let o of t){let[n,s,i,l,u]=o;r.push({statement:n,fromName:s.trim(),toName:l.trim(),afterCharacter:u})}return r},Bo=(e,t)=>{var s;let r=e.substring(0,e.indexOf(t.statement)),o=J(r).pop();return o?r.substring(r.indexOf(o==null?void 0:o.statement)+((s=o==null?void 0:o.statement)==null?void 0:s.length)):r},Lo=(e,t)=>!!(t?Bo(e,t):"").trim(),Dt=["react","@refinedev/core","@refinedev/"],jt=e=>{var m;let t=e,r=J(e),o=r.filter(c=>!c.isType),n=r.filter(c=>c.isType),s=[],i=[];n.forEach(c=>{t=t.replace(`${c.statement}
`,"")}),o.forEach(c=>{Lo(t,c)?s.push(c):i.push(c)});let l=t.indexOf((m=i==null?void 0:i[0])==null?void 0:m.statement);i.forEach(c=>{t=t.replace(c.statement,"")});let u=i.reduce((c,p)=>{let{importPath:f}=p;return c[f]?c[f].push(p):c[f]=[p],c},{}),h=[...Object.entries(u).map(([c,p])=>{let f=p.find(x=>x.defaultImport),v=p.find(x=>x.namespaceImport),w=p.filter(x=>x.namedImports).map(x=>(x.namedImports??"").replace(/{|}/g,"").trim().split(",").map(Pe=>Pe.trim()).filter(Boolean).join(", ")).join(", "),S="";return v&&(S+=`${v.statement}
`),(f||w)&&(f&&w?S+=`import ${f.defaultImport}, { ${w} } from "${p[0].importPath}";
`:f?S+=`import ${f.defaultImport} from "${p[0].importPath}";
`:S+=`import { ${w} } from "${p[0].importPath}";
`),[c,S]})].sort(([c],[p])=>{let f=Dt.findIndex(w=>c.includes(w)),v=Dt.findIndex(w=>p.includes(w));return f===v?c.localeCompare(p):f===-1?1:v===-1?-1:f-v}).map(([,c])=>c).join(""),P=[...n.map(c=>c.statement),""].join(`
`);return t=t.substring(0,l)+h+P+t.substring(l),t};var Ot=(e,t)=>{let r=J(e),o=r[r.length-1],n=o?e.indexOf(o.statement):e.length-1;return`${e.slice(0,n+(o==null?void 0:o.statement.length))}
${t}
${e.slice(n+(o==null?void 0:o.statement.length))}`};import{readFileSync as Wo}from"fs-extra";import{join as zo}from"path";function ue(e){if(this!=null&&this.absolutePackageDir)try{return Wo(zo(this.absolutePackageDir,e)).toString()}catch{return}}var _t=I("module"),qo=_t.prototype.require,$t=(e,t)=>{_t.prototype.require=function(...r){return r[0]==="@refinedev/cli"?{...Fe,getFileContent:o=>ue.call({absolutePackageDir:t?e:Xo.join(process.cwd(),e)},o)}:qo.apply(this,r)}};var Ve=async(e,t)=>{try{return $t(e,t),I(Ft.join(t?e:Ft.join(process.cwd(),e),"refine.config.js"))}catch{return}};import Qo from"dedent";var T={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};import E from"chalk";import Jo from"chalk";import Ho from"cardinal";import Yo from"boxen";var Ko=e=>{let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,o]=t.exec(e)??[];if(o){let n=o.trim(),s=e.replace(r||"","");return{title:n,code:s}}return{code:e}},Vt=e=>{let{title:t,code:r}=Ko(e),o="";try{o=Ho.highlight(r,{jsx:!0})}catch{o=r}return Yo(o,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?Jo.bold(t):void 0})};import{marked as Go}from"marked";import Zo from"marked-terminal";var fe=e=>Go(e,{renderer:new Zo({code:Vt})});var Mt=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let o=t.filter(([,a])=>Object.values(T).filter(d=>d!==T.SUCCESS).includes(a)),n="success";switch(o.length){case 0:n="success";break;case t.length:n="error";break;default:n="warning";break}let s=a=>{let d=a==null?void 0:a.replace(process.cwd(),"");return d!=null&&d.startsWith("/")?d.slice(1):d!=null&&d.startsWith("./")?d.slice(2):d},i=()=>{switch(n){case"success":console.log(E.blueBright(`Successfully swizzled ${E.bold(e)}`));return;case"warning":console.log(E.yellowBright(`Swizzle completed with errors for ${E.bold(e)}`));return;case"error":console.log(E.redBright(`Swizzle failed for ${E.bold(e)}`));return;default:return}},l=()=>{let a=[];a.push(E.dim(`File${t.length>1?"s":""} created:`)),a.push(t.map(([d,h])=>h===T.SUCCESS?E.cyanBright.dim(` - ${s(d)}`):h===T.TARGET_ALREADY_EXISTS?E.cyanBright.dim(` - ${E.yellowBright.bold("[FILE_ALREADY_EXISTS] ")}${s(d)}`):h===T.SOURCE_PATH_NOT_A_FILE?E.cyanBright.dim(` - ${E.yellowBright.bold("[SOURCE NOT FOUND] ")}${s(d)}`):E.cyanBright.dim(` - ${E.yellowBright.bold(`[${h}]`)}${s(d)}`)).join(`
`)),console.log(a.join(`
`))},u=()=>{r&&n!=="error"&&console.log(fe(Qo(`
${r}`)))};console.log(""),i(),l(),console.log(""),u()};var Ut=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};import ln from"boxen";var Bt=()=>{let e;try{e=g()}catch{e=void 0}return me(e)};import en from"inquirer";import tn from"chalk";var Lt=async e=>{await rn(e)?await L(e):await on(e)},rn=async e=>{let t=`This component requires following packages to be installed:
`.concat(e.map(o=>` - ${o}`).join(`
`)).concat(`
Do you want to install them?`),{installRequiredPackages:r}=await en.prompt([{type:"confirm",name:"installRequiredPackages",default:!0,message:t}]);return r},on=async e=>{let t=await C(),r=N[t.name].add.join(" "),o=e.join(" "),n=`${t.name} ${r} ${o}`;console.log(`
You can install them manually by running this command:`),console.log(tn.bold.blueBright(n))};var pn=e=>e.command("swizzle").description(`Export a component or a function from ${H.bold("Refine")} packages to customize it in your project`).action(mn),Xt=e=>(t,r="")=>e.filter(n=>{var s;return n.label.toLowerCase().includes(r.toLowerCase())||((s=n.group)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))}).flatMap((n,s,i)=>{var a;return[...(n==null?void 0:n.group)&&((a=i[s-1])==null?void 0:a.group)!==n.group&&n.group?[new ge.Separator(H.bold(n.group))]:[],{name:` ${n.label}`,value:n!=null&&n.value?n.value:n}]}),mn=async e=>{var d,h,P;ge.registerPrompt("autocomplete",nn);let t=await G(),r=[];if(await Promise.all(t.map(async m=>{let c=await Ge(m.path),p=r.findIndex(f=>f.name===m.name)===-1;c&&p&&r.push(m)})),r.length===0){console.log("No Refine packages found with swizzle configuration.");return}console.log(`${ln(`Found ${H.blueBright(r.length)} installed ${H.blueBright.bold("Refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let o=await Promise.all(r.map(async m=>{let c=await Ve(m.path,!0)??await Ve(m.path,!1)??{swizzle:{items:[]}};return{...m,config:c}})),{selectedPackage:n}=await ge.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:Xt(o.sort((m,c)=>{var p,f;return(((p=m.config)==null?void 0:p.group)??"").localeCompare(((f=c.config)==null?void 0:f.group)??"")}).map(m=>{var c,p;return{label:((c=m.config)==null?void 0:c.name)??m.name,value:m,group:(p=m.config)==null?void 0:p.group}}))}]),{swizzle:{items:s,transform:i}}=n.config,l;if(s.length===0){console.log(`No swizzle items found for ${H.bold(((d=n.config)==null?void 0:d.name)??n.name)}`);return}if(s.length===1?l=s[0]:s.length>1&&(l=(await ge.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:Xt(s.sort((c,p)=>c.group.localeCompare(p.group)))({},"")}])).selectedComponent),!l){console.log(`No swizzle items selected for ${H.bold(((h=n.config)==null?void 0:h.name)??n.name)}`);return}let u=Bt(),a=await Promise.all(l.files.map(async m=>{var c;try{let p=m.src?Wt.join(n.path,m.src):void 0,f=m.dest?Wt.join(process.cwd(),u,m.dest):void 0;if(!p)return console.log("No src path found for file",m),["",T.SOURCE_PATH_NOT_FOUND];if(!f)return console.log("No destination path found for file",m),["",T.TARGET_PATH_NOT_FOUND];if(!await zt(p))return[f,T.SOURCE_PATH_NOT_A_FILE];let w=await an(p,"utf-8");if(await zt(f))return[f,T.TARGET_ALREADY_EXISTS];await sn(f);let x=Ut(w),O=((c=m.transform)==null?void 0:c.call(m,x))??x,Pe=(i==null?void 0:i(O,p,f))??O,yr=jt(Pe),wr=await Ne(yr);return await cn(f,wr),[f,T.SUCCESS]}catch{return["",T.UNKNOWN_ERROR]}}));a.length>0&&(Mt({files:a,label:l.label,message:l.message}),(P=l==null?void 0:l.requiredPackages)!=null&&P.length&&await Lt(l.requiredPackages))},qt=pn;import gn from"inquirer";import hn from"center-align";import{Option as vn}from"commander";import yn from"@npmcli/package-json";import oe from"inquirer";import Ht from"semver-diff";import Me from"chalk";var Jt=e=>{let t=e.filter((o,n)=>e.indexOf(o)!==n),r=new Set(t);return Array.from(r)};var Yt=async e=>{let t=un(e);if(!t){console.log("All `Refine` packages are up to date. \u{1F389}");return}let r=fn(t),o=await oe.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:dn}]);if(o.packages.length>0){let n={};return o.packages.forEach(s=>{let{name:i,version:l}=Ie(s);n[i]=l??"latest"}),n}return null},dn=e=>{let r=e.map(n=>Ie(n)).map(n=>n.name),o=Jt(r);return o.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${o.join(", ")}`:!0},un=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let o=r.current,n=Ht(o,r.wanted),s=Ht(o,r.latest);if(n===s&&s){t[s].push({name:r.name,from:o,to:r.latest});return}n&&t[n].push({name:r.name,from:o,to:r.wanted}),s&&t[s].push({name:r.name,from:o,to:r.latest})}),t},fn=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(a=>{a.forEach(d=>{d.name.length>t&&(t=d.name.length),d.from.length>r&&(r=d.from.length)})}),t+=2;let o=[],n="Package".padEnd(t),s="From".padEnd(r),l=`
   ${n} ${s}${"To".padStart(r)}`;o.push(new oe.Separator(l)),e.patch.length>0&&(o.push(new oe.Separator(Me.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(a=>{o.push({name:`${a.name.padEnd(t)} ${a.from.padStart(r)} -> ^${a.to}`,value:`${a.name}@^${a.to}`})})),e.minor.length>0&&(o.push(new oe.Separator(Me.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(a=>{o.push({name:`${a.name.padEnd(t)} ${a.from.padStart(r)} -> ^${a.to}`,value:`${a.name}@^${a.to}`})})),e.major.length>0&&(o.push(new oe.Separator(Me.reset.bold.blue(`
Major Updates`))),e.major.forEach(a=>{o.push({name:`${a.name.padEnd(t)} ${a.from.padStart(r)} -> ^${a.to}`,value:`${a.name}@^${a.to}`})}));let u=o.length+6;return{choices:o,pageSize:u}};import Y from"chalk";var wn=e=>e.command("update").description("Interactively select and update all `Refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new vn("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `Refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(Pn),Pn=async e=>{let{tag:t,dryRun:r,all:o}=e,n=await k(Q,"Checking for updates...");if(!(n!=null&&n.length)){console.log("All `Refine` packages are up to date \u{1F389}");return}let s=null;if(o){let a=await Ue(t,n);if(!a)return;if(r){Kt(a);return}Gt(a);return}let{table:i,width:l}=le(n)??"";console.log(hn("Available Updates",l)),console.log(i),console.log(`- ${Y.yellow(Y.bold("Current"))}: The version of the package that is currently installed`),console.log(`- ${Y.yellow(Y.bold("Wanted"))}: The maximum version of the package that satisfies the semver range specified in \`package.json\``),console.log(`- ${Y.yellow(Y.bold("Latest"))}: The latest version of the package available on npm`),console.log();let{installationType:u}=await gn.prompt([{type:"list",name:"installationType",message:"Do you want to update all Refine packages for minor and patch versions?",choices:[{name:'Update all packages to latest "minor" version without any breaking changes.',value:"minor"},{name:"Update all packages to the latest version that satisfies the semver(`wanted`) range specified in `package.json`",value:"wanted"},{name:'Use interactive mode. Choose this option for "major" version updates.',value:"interactive"}]}]);u==="interactive"&&(s=await Yt(n)),u==="wanted"&&(s=await Ue("wanted",n)),u==="minor"&&(s=await Ue("minor",n)),s&&(r?Kt(s):Gt(s))},Ue=async(e,t)=>{if(e==="wanted"&&t.every(n=>n.current===n.wanted))return console.log(),console.log("\u2705 All `Refine` packages are already at the wanted version"),null;console.log();let r={};for(let o of t){let n=o.latest;e==="minor"&&(n=`^${await k(()=>at(o.name,o.wanted),`Checking for the latest minor version of ${o.name}`)}`),e==="wanted"&&(n=it(o.name,o.wanted)),e==="latest"&&(n=`^${o.latest}`),e==="next"&&(n="next"),r[o.name]=n}return r},Kt=async e=>{let t=await C(),r=N[t.name].add,o="";for(let[n,s]of Object.entries(e))o+=`${n}@${s} `;console.log(),console.log(`${t.name} ${r.join(" ")} ${o}`)},Gt=async e=>{console.log("Updating `Refine` packages...");let t=await yn.load(process.cwd());t.update({dependencies:{...t.content.dependencies??{},...e??{}}}),await t.save(),L([],"all")},Zt=wn;import xn from"envinfo";import In from"ora";var En=e=>e.command("whoami").description("View the details of the development environment").action(Rn),Rn=async()=>{let e=In("Loading environment details...").start(),t=await xn.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),o=(await V()||[]).map(n=>` - ${n.name}: ${n.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(o)},Qt=En;import ye from"chalk";import we from"inquirer";import On from"inquirer";import Tn from"execa";var he=async e=>{let{incompatiblePackages:t,integrationName:r,requiredPackages:o,transformerFileName:n}=e;if(et(t))return;await Qe(o),console.log(`\u{1F680} Setting up ${r}...`);let s=I.resolve(".bin/jscodeshift"),{stderr:i}=Tn.sync(s,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/integrations/${n}.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);i&&console.log(i),console.log(`\u{1F389} ${r} setup completed!`)};import Be from"chalk";var ve=e=>{let{id:t,title:r,description:o,disabled:n}=e;return n?{value:t,name:`${Be.gray(r)}`,disabled:Be.redBright(n)}:{value:t,name:`${Be.blueBright(r)} - ${o}`}};var er="ant-design",Cn="Ant Design",kn=["@remix-run/react","next"],bn=["antd","@refinedev/antd"],Sn="ant-design",tr={id:er,getChoice:e=>{let t="Ant Design",r="Setup Ant Design with Refine",o;return["nextjs","remix","remix-vite","remix-spa"].includes(e)&&(o="Automatic setup only available Vite for now. See the documentation for manual installation: https://refine.dev/docs/ui-integrations/ant-design/introduction/#installation"),ve({id:er,title:t,description:r,disabled:o})},runTransformer:async()=>await he({incompatiblePackages:kn,integrationName:Cn,requiredPackages:bn,transformerFileName:Sn})};var rr="react-router",Nn="React Router",Dn=["@remix-run/react","next"],An=["react-router","@refinedev/react-router"],jn="react-router",or={id:rr,getChoice:e=>{let t="React Router",r="Setup routing with React Router",o;return e==="nextjs"&&(o="Can't be used with Next.js. https://nextjs.org/docs/app/building-your-application/routing"),(e==="remix"||e==="remix-vite"||e==="remix-spa")&&(o="Can't be used with Remix. https://remix.run/docs/en/main/discussion/routes"),ve({id:rr,title:t,description:r,disabled:o})},runTransformer:async()=>await he({incompatiblePackages:Dn,integrationName:Nn,requiredPackages:An,transformerFileName:jn})};var U=[tr,or];var Le=()=>{let e=g(),t=U.map(r=>r.getChoice(e));return t.every(r=>r.disabled)?[{value:"none",name:"No integration available for this project type."},...t]:t},nr=async()=>await On.prompt([{type:"list",name:"id",message:"Which integration do you want to add?",choices:Le(),default:"none"}]);import Un from"chalk";import Bn from"inquirer";import{copySync as sr,existsSync as _n,mkdirSync as $n,pathExistsSync as ir,readdirSync as Fn}from"fs-extra";import{join as B,relative as ar}from"path";var K=[{id:"auth",title:"Auth provider",description:"Manage user authentication and authorization",fileName:"auth-provider.tsx",templateFileName:"demo-auth-provider.tsx.template"},{id:"live",title:"Live provider",description:"Enable real-time updates and synchronization",fileName:"live-provider.tsx",templateFileName:"demo-live-provider.tsx.template"},{id:"data",title:"Data provider",description:"Communicate with your API",fileName:"data-provider.tsx",templateFileName:"demo-data-provider.tsx.template"},{id:"access-control",title:"Access Control",description:"Manage user permissions & roles",fileName:"access-control-provider.tsx",templateFileName:"demo-access-control-provider.tsx.template"},{id:"notification",title:"Notification provider",description:"Display in-app alerts and messages",fileName:"notification-provider.tsx",templateFileName:"demo-notification-provider.tsx.template"},{id:"i18n",title:"I18n provider",description:"Support multiple languages and locales",fileName:"i18n-provider.tsx",templateFileName:"demo-i18n-provider.tsx.template"},{id:"audit-log",title:"Audit Log provider",description:"Display audit logs for your resources",fileName:"audit-log-provider.tsx",templateFileName:"demo-audit-log-provider.tsx.template"}];var Vn=`${__dirname}/../templates/provider`,We=`${__dirname}/../templates/assets`,ne=(e,t)=>{e.forEach(r=>{let{fileName:o,templateFileName:n}=Mn(r),s=me(g()),i=t??ze(),l=B(i,o),u=B(process.cwd(),i,o),a=B(process.cwd(),s);if(ir(u)){console.error(`\u274C Provider (${l}) already exist!`);return}$n(i,{recursive:!0}),sr(`${Vn}/${n}`,u),console.log(`\u{1F389} Provider (${l}) created successfully!`);let d=[],h=[];if(ir(`${We}/${r}`))try{Fn(`${We}/${r}`,{recursive:!0,withFileTypes:!0}).forEach(P=>{if(!P.isDirectory()){let m=B(P.path,P.name),c=B(a,ar(B(We,r),P.path),P.name),p=B(s,ar(a,c));if(_n(c))h.push(p);else try{sr(m,c),d.push(p)}catch{h.push(p)}}})}catch{}d.length&&console.log(`\u{1F389} Created additional assets: ${d.join(", ")}`),h.length&&console.error(`\u274C Failed to create assets: ${h.join(", ")}`)})},Mn=e=>{let t=K.find(r=>r.id===e);if(!t)throw new Error(`Invalid provider: ${e}`);return t},ze=()=>{let e=g(),{path:t}=dt(e);return t};var Xe=()=>K.map(e=>{let{id:t,title:r,description:o}=e;return{value:t,name:`${Un.blueBright(r)} - ${o}`}}),cr=async()=>await Bn.prompt([{type:"checkbox",name:"providers",message:"Which providers do you want to add?",choices:Xe()},{type:"input",name:"providersPath",message:"Where do you want to generate the providers?",default:ze()}]);var lr=(e,t)=>t.map(r=>({...r,name:` . ${r.name}`,value:{group:e,component:r.value}})),pr=async()=>await we.prompt([{type:"list",name:"component",message:"What do you want to add?",choices:[new we.Separator(ye.bold("Provider")),...lr("provider",Xe()),new we.Separator(ye.bold("Integration")),...lr("integration",Le()),new we.Separator(ye.bold("Resource")),{name:ye.blueBright(" .  Add new resource"),value:{group:"resource",component:"resource"}}],pageSize:25}]);import{Argument as Ln,Command as Wn}from"commander";var zn=async e=>{let t=e;t||(t=(await nr()).id);let r=U.find(o=>o.id===t);r&&await r.runTransformer()},mr=new Wn("integration").addArgument(new Ln("[name]","Name of the integration").choices(U.map(e=>e.id))).action(zn);import{Argument as Xn,Command as qn}from"commander";var Jn=async(e,t)=>{if(!e.length){let{providers:r,providersPath:o}=await cr();return ne(r,o)}ne(e,t.path)},dr=new qn("provider").addArgument(new Xn("[providers...]","Create provider(s)").choices(K.map(e=>e.id)).default([])).option("-p, --path [path]","Path to generate providers").action(Jn);import{Argument as Hn,Command as Yn}from"commander";var Kn=async(e,t,r)=>{W({actions:t==null?void 0:t.actions,path:r.optsWithGlobals().path},e)},ur=new Yn("resource").addArgument(new Hn("[resources...]","Create new resource(s)")).option("-p, --path [path]","Path to generated resource files").option("-a, --actions [actions]","Only generate the specified resource actions. (ex: list,create,edit,show)","list,create,edit,show").action(Kn);var Gn=e=>e.command("add").description("Add new resources, providers, or integrations").allowExcessArguments(!1).action(Zn).addCommand(ur).addCommand(dr).addCommand(mr),Zn=async()=>{let{component:e}=await pr();if(e.group==="provider"&&ne([e.component]),e.group==="integration"){let t=U.find(r=>r.id===e.component);await(t==null?void 0:t.runTransformer())}e.group==="resource"&&await W({},[])},fr=Gn;import Qn from"envinfo";import es from"os";var ts=()=>{let e=es.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},gr=async()=>{let[e,t]=await Qn.helpers.getOSInfo();return{name:ts(),version:t}};import rs from"node-fetch";var os=async()=>{let e=await gr();return{nodeEnv:b.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await V()||[],projectFramework:g(),projectId:Ze()}},hr=async()=>{if(b.REFINE_NO_TELEMETRY!=="true")try{let e=await os();await rs("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};import ns from"gray-matter";import ss from"boxen";var is="https://raw.githubusercontent.com/refinedev/refine/main/packages/cli/ANNOUNCEMENTS.md",qe="---announcement",as=e=>e.split(qe).slice(1).map(r=>`${qe}${r}`),cs=e=>{let t=e.replace(qe,"---"),r=ns(t),o=(r.content.length===0?t.replace(/---/g,""):r.content.replace(/---/g,"")).trim();return{...r.data,content:o}},ls=async()=>{try{let e=await fetch(is).then(r=>r.text()).catch(()=>"");return as(e).map(r=>cs(r))}catch{return[]}},vr=async()=>{let t=(await ls()).filter(o=>!o.hidden);if(t.length===0)return;let r=t.map(o=>{let n=t.length>1?"\u2014 ":"",s=fe(o.content);return`${n}${s}`}).join("").trim();console.log(ss(r,{padding:1,margin:0,borderStyle:"round",borderColor:"blueBright",titleAlignment:"left"}))};var ds="1.0.0",us=()=>{let e=new ps;e.version(`@refinedev/cli@${ds}`,"-v, --version","Output the current version.").description(ms.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),qt(e),vt(e),Zt(e),Oe(e),_e(e),Se(e),$e(e),ct(e),Qt(e),bt(e),fr(e),e.hook("preAction",async t=>{t.args.includes("dev")&&await vr()}),e.hook("postAction",t=>{let r=t.args[0];["run"].includes(r)||hr()}),e.parse(process.argv),process.argv.slice(2).length||e.outputHelp()};us();
//# sourceMappingURL=cli.mjs.map