#!/usr/bin/env node
var xo=Object.create;var _e=Object.defineProperty;var Io=Object.getOwnPropertyDescriptor;var Eo=Object.getOwnPropertyNames;var Ro=Object.getPrototypeOf,To=Object.prototype.hasOwnProperty;var Co=(e,t)=>{for(var r in t)_e(e,r,{get:t[r],enumerable:!0})},ko=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Eo(t))!To.call(e,n)&&n!==r&&_e(e,n,{get:()=>t[n],enumerable:!(o=Io(t,n))||o.enumerable});return e};var i=(e,t,r)=>(r=e!=null?xo(Ro(e)):{},ko(t||!e||!e.__esModule?_e(r,"default",{value:e,enumerable:!0}):r,e));var vo=require("commander"),yo=i(require("figlet"));var F=i(require("chalk")),ye=i(require("center-align"));var pt=i(require("ora")),bo=async(e,t)=>{let r=(0,pt.default)({color:"cyan",text:t}).start(),o=await e();return r.stop(),o},S=bo;var ne=i(require("execa")),_=require("fs-extra"),mt=i(require("globby")),$e=i(require("path")),dt=i(require("preferred-pm")),$=()=>{if(!(0,_.existsSync)("package.json"))throw console.error("\u274C `package.json` not found."),new Error("./package.json not found");return JSON.parse((0,_.readFileSync)("package.json","utf8"))},L=()=>{let e=$();return Object.keys(e.dependencies||{})},ut=()=>{let e=$();return(e==null?void 0:e.dependencies)||{}},ft=()=>{let e=$();return Object.keys(e.devDependencies||{})},So=()=>[...L(),...L()],ge=()=>{let e=$();return(e==null?void 0:e.scripts)||{}},X=async()=>{var e;try{let t=await(0,ne.default)("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},o=Object.keys(r).filter(s=>s.startsWith("@refinedev")||s.startsWith("@pankod/refine-")),n=[];for(let s of o){let a=r[s].version;n.push({name:s,version:a})}return n}catch{return Promise.resolve(null)}},se=async()=>{let e=["ably","airtable","antd","appwrite","chakra-ui","codemod","core","devtools","devtools-internal","devtools-server","devtools-shared","devtools-ui","graphql","hasura","inferencer","kbar","mantine","medusa","mui","nestjs-query","nestjsx-crud","nextjs-router","react-hook-form","react-router","react-router-v6","react-table","remix-router","shared","simple-rest","strapi","strapi-v4","supabase"];try{let t=await(0,mt.default)("node_modules/@refinedev/*",{onlyDirectories:!0}),r=e.flatMap(n=>{try{let s=require.resolve($e.default.join("@refinedev",n,"package.json"));return[$e.default.dirname(s)]}catch{return[]}}),o=[];return await Promise.all([...r,...t].map(async n=>{if(await(0,_.pathExists)(`${n}/package.json`)){let a=await(0,_.readJSON)(`${n}/package.json`);o.push({name:a.name,version:a.version,path:n})}})),o}catch{return[]}},gt=async e=>await(0,_.pathExists)(`${e}/refine.config.js`),j={npm:{add:["install","--save"],addDev:["install","--save-dev"],outdatedJson:["outdated","--json"],install:["install"]},yarn:{add:["add"],addDev:["add","-D"],outdatedJson:["outdated","--json"],install:["install"]},pnpm:{add:["add"],addDev:["add","-D"],outdatedJson:["outdated","--format","json"],install:["install"]},bun:{add:["add"],addDev:["add","--dev"],outdatedJson:["outdated","--format","json"],install:["install"]}},k=async()=>{let e=await S(()=>(0,dt.default)(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},Y=async(e,t="all",r="All `Refine` packages updated  \u{1F389}")=>{let o=await k();try{let n=t==="all"?j[o.name].install:j[o.name].add,s=(0,ne.default)(o.name,[...n,...e],{stdio:"inherit"});s.on("message",a=>{console.log(a)}),s.on("error",a=>{console.log(a)}),s.on("exit",a=>{if(a===0){console.log(r);return}console.log(`Application exited with code ${a}`)})}catch(n){throw new Error(n)}},Fe=async e=>{let t=await k();try{let r=j[t.name].add,o=ne.default.sync(t.name,[...r,...e],{stdio:"inherit"});if(o.failed||o.exitCode!==0)throw new Error(o.stderr);return o}catch(r){throw new Error(r)}},Ve=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}},ht=()=>{var t;let e=$();return(t=e==null?void 0:e.refine)==null?void 0:t.projectId},he=async()=>(await se()).some(t=>t.name==="@refinedev/devtools"),No=e=>{let t=L();return e.filter(r=>!t.includes(r))},vt=async e=>{console.log("\u{1F331} Checking dependencies...");let t=No(e);t.length>0?(console.log(`\u{1F331} Installing ${t.join(", ")}`),await Fe(t),console.log("\u{1F389} Installation complete...")):console.log("\u{1F389} All required packages are already installed")},yt=e=>{let t=So(),r=e.filter(o=>t.includes(o));return r.length>0?(console.log(`\u{1F6A8} This feature doesn't support ${r.join(", ")} package.`),!0):!1},wt=async e=>{let t="npm",{stdout:r,timedOut:o}=await(0,ne.default)(t,["view",e,"versions","--json"],{reject:!1,timeout:25e3});o&&(console.log("\u274C Timed out while checking for updates."),process.exit(1));let n=[];try{n=JSON.parse(r),(!n||"error"in n)&&(console.log("\u274C Something went wrong while checking for updates."),process.exit(1))}catch{console.log("\u274C Something went wrong while checking for updates."),process.exit(1)}return n},Pt=async e=>{let t=await X();return t?t.some(r=>r.name===e):!1};var Rt=i(require("cli-table3")),ae=i(require("chalk"));var xt=e=>e.charAt(0).toUpperCase()+e.slice(1),It=e=>e.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"");var ie={name:"name",current:"current",wanted:"wanted",latest:"latest",changelog:"changelog"},Me=[ie.name,ie.current,ie.wanted,ie.latest,ie.changelog],ve=(e=[])=>{var x;let t=Object.keys((e==null?void 0:e[0])||{});if(!e||!t.length)return{table:"",width:0};let r=process.stdout.columns||80,o=Math.max(...e.map(d=>d.name.length))+2,n=7+2,s=6,a=Math.min(35,r-o-n*3-s),p={name:o,current:n,wanted:n,latest:n,changelog:a},f=new Rt.default({head:Me,wordWrap:!1,wrapOnWordBoundary:!0,colWidths:Me.map(d=>p[d]),style:{head:["blue"]}}),c=(d,l)=>{if(d.length>l){let m=l-3,g=d.slice(0,Math.floor(m/2)),y=d.slice(-Math.ceil(m/2));return`${g}...${y}`}return d};e.forEach(d=>{f.push(Me.map(l=>{let m=d[l];if(!m)return m;if(l==="latest"||l==="wanted"){let g=Et(d.current),y=Et(m),P=Do(g,y),A=ae.default[P.major](y.major),I=ae.default[P.minor](y.minor),B=ae.default[P.patch](y.patch);return`${A}.${I}.${B}`}return l==="changelog"?ae.default.blueBright.underline(m):m}))});let u=f.toString(),v=It(((x=u.split(`
`))==null?void 0:x[0])||"").length;return{table:u,width:v}},Et=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},Do=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"};var we=async e=>{let t=e==null?void 0:e.data,r=Object.keys((t==null?void 0:t[0])||{});if(!t||!r.length)return;let{table:o,width:n}=ve(t);console.log(),console.log((0,ye.default)("Update Available",n)),console.log(),console.log(`- ${F.default.yellow(F.default.bold("Current"))}: The version of the package that is currently installed`),console.log(`- ${F.default.yellow(F.default.bold("Wanted"))}: The maximum version of the package that satisfies the semver range specified in \`package.json\``),console.log(`- ${F.default.yellow(F.default.bold("Latest"))}: The latest version of the package available on npm`),console.log(o),console.log((0,ye.default)(`To update ${F.default.bold("`Refine`")} packages with wanted version`,n)),console.log((0,ye.default)(` Run the following command: ${F.default.yellowBright(await Ao())}`,n)),console.log()},Ao=async()=>{let e="npx @refinedev/cli update",t=L(),r=Object.keys(ge()),o=t.includes("@refinedev/cli"),n=r.includes("refine");if(!o&&!n)return e;let s=await k();return n?`${s.name} run refine update`:o?"npx refine update":e};var Tt=i(require("execa"));var Ct=i(require("semver-diff")),kt=require("semver"),Oo=e=>e.command("check-updates").description("Check all installed `Refine` packages are up to date").action(jo),jo=async()=>{let e=await S(ce,"Checking for updates...");if(!e.length){console.log("All `Refine` packages are up to date \u{1F389}\n");return}await we({data:e})},ce=async()=>await _o(),_o=async()=>{let e=await $o();if(!e)return[];let t=[];return Object.keys(e).forEach(o=>{let n=e[o];o.includes("@refinedev")&&t.push({...n,name:o,changelog:o.replace(/@refinedev\//,"https://c.refine.dev/")})}),t.filter(o=>!!(0,Ct.default)(o.current,o.latest))},$o=async()=>{let e="npm",{stdout:t,timedOut:r}=await(0,Tt.default)(e,j[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},bt=(e,t)=>{let o=ut()[e];return o?o==="latest"?"latest":o==="*"?"*":[">","<",">=","<=","||"].some(n=>o.includes(n))?o:o!=null&&o.includes("x")?`${o}`:o!=null&&o.startsWith("~")?`~${t}`:o!=null&&o.startsWith("^")?`^${t}`:t:`^${t}`},St=async(e,t)=>{let r=await wt(e);return(0,kt.maxSatisfying)(r,`^${t}`)??t},Nt=Oo;var w=(c=>(c.REACT_SCRIPT="react-scripts",c.REMIX="remix",c.REMIX_VITE="remix-vite",c.REMIX_SPA="remix-spa",c.NEXTJS="nextjs",c.VITE="vite",c.CRACO="craco",c.PARCEL="parcel",c.UNKNOWN="unknown",c))(w||{});var Ue=(n=>(n.ANTD="antd",n.MUI="mui",n.MANTINE="mantine",n.CHAKRA="chakra-ui",n))(Ue||{});var Dt=(o=>(o.NPM="npm",o.YARN="yarn",o.PNPM="pnpm",o))(Dt||{});var h=e=>{if(e)return e;let t=[],r=[];try{t=L(),r=ft()}catch{}return t.includes("@craco/craco")||r.includes("@craco/craco")?"craco":t.includes("react-scripts")||r.includes("react-scripts")?"react-scripts":t.includes("next")||r.includes("next")?"nextjs":t.includes("@remix-run/react")||r.includes("@remix-run/react")?t.includes("vite")||r.includes("vite")?"remix-vite":"remix":t.includes("vite")||r.includes("vite")?"vite":t.includes("parcel")||r.includes("parcel")?"parcel":"unknown"},At=()=>{let e=L();if(e.includes("@refinedev/antd"))return"antd";if(e.includes("@refinedev/mui"))return"mui";if(e.includes("@refinedev/chakra-ui"))return"chakra-ui";if(e.includes("@refinedev/mantine"))return"mantine"},Ot=e=>{switch(e){case"react-scripts":return"REACT_APP_REFINE_DEVTOOLS_PORT";case"nextjs":return"NEXT_PUBLIC_REFINE_DEVTOOLS_PORT";case"vite":return"VITE_REFINE_DEVTOOLS_PORT";default:return"REFINE_DEVTOOLS_PORT"}};var jt=i(require("camelcase")),le=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":case"remix-vite":case"remix-spa":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},_t=e=>{switch(e){case"nextjs":return{path:"src/providers",alias:"../src/providers"};case"remix":case"remix-vite":case"remix-spa":return{path:"app/providers",alias:"~/providers"}}return{path:"src/providers",alias:"providers"}},Pe=e=>{switch(e){case"remix":case"remix-vite":case"remix-spa":return"./app";default:return"./src"}},$t=e=>(0,jt.default)(e,{preserveConsecutiveUppercase:!0,pascalCase:!0});var W=i(require("handlebars")),O=require("fs-extra");var Fo=(e,t)=>{let r=(0,O.readFileSync)(e);return W.default.registerHelper("ifIn",(n,s,a)=>n.includes(s)?a.fn(W.default):a.inverse(W.default)),W.default.registerHelper("formatInferencerComponent",n=>{if(n)switch(n){case"chakra-ui":return"ChakraUI";default:return n.charAt(0).toUpperCase()+n.slice(1)}}),W.default.registerHelper("capitalize",n=>{if(n)return n.charAt(0).toUpperCase()+n.slice(1)}),W.default.registerHelper("getComponentNameByResource",n=>{if(n)return $t(n)}),W.default.compile(r.toString())(t)},Be=(e,t)=>{(0,O.readdirSync)(e,{recursive:!0}).forEach(o=>{if(typeof o!="string"||!o.endsWith(".hbs"))return;let n=`${e}/${o}`,s=`${e}/${o.replace(".hbs","")}`;(0,O.createFileSync)(s),(0,O.writeFileSync)(s,Fo(n,t)),(0,O.unlinkSync)(n)})};var Ft=i(require("execa")),R=require("fs-extra"),Vt=i(require("inquirer")),K=require("path"),Mt=require("pluralize"),xe=i(require("temp")),pe=["list","create","edit","show"],G=async(e,t)=>{var s;let r=(e==null?void 0:e.path)||le(h()).path,o=e.actions||pe.join(",");if(!t.length){let{name:a,selectedActions:p}=await Vt.default.prompt([{type:"input",name:"name",message:"Resource Name (users, products, orders etc.)",validate:f=>f?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:pe,default:(s=e==null?void 0:e.actions)==null?void 0:s.split(",")}]);t=[a],o=p.join(",")}let n=!1;t.forEach(a=>{let p=o?o.split(","):void 0,f=(0,Mt.plural)(a).toLowerCase(),c=(0,K.join)(process.cwd(),r,f);if((0,R.pathExistsSync)(c)){console.error(`\u274C Resource (${(0,K.join)(r,f)}) already exist!`);return}n=!0;let u=xt(a),v=At(),d=h()==="nextjs",l=`${Le()}/../templates/resource/components`,m=Vo();(0,R.copySync)(l,m);let g={resourceName:a,resource:u,actions:p||pe,uiFramework:v,isNextJs:d};Be(m,g),p&&pe.forEach(B=>{p.includes(B)||(0,R.unlinkSync)(`${m}/${B}.tsx`)}),(0,R.mkdirSync)(r,{recursive:!0});let y=`${r}/${f}`,P={};(0,R.pathExistsSync)(y)&&(P={overwrite:!0}),(0,R.moveSync)(m,y,P),xe.default.cleanupSync(),d&&Mo(u,f,p||pe);let A=require.resolve(".bin/jscodeshift"),{stderr:I}=Ft.default.sync(A,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${Le()}/../src/transformers/resource.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist",`--__actions=${g.actions}`,`--__pathAlias=${le(h()).alias}`,`--__resourceFolderName=${f}`,`--__resource=${u}`,`--__resourceName=${a}`]);I&&console.log(I),console.log(`\u{1F389} Resource (${y}) generated successfully!`)}),n&&Uo()},Le=()=>__dirname,Vo=()=>(xe.default.track(),xe.default.mkdirSync("resource")),Mo=(e,t,r)=>{let o=(0,K.join)(process.cwd(),"src/app/",t),n={list:"/",create:"/create",edit:"/edit/[id]",show:"/show/[id]"};r.forEach(a=>{let p=n[a],f=(0,K.join)(o,p);(0,R.mkdirSync)(f,{recursive:!0});let c=`${Le()}/../templates/resource/pages/next/${p}/page.tsx.hbs`,u=(0,K.join)(f,"page.tsx.hbs");(0,R.copySync)(c,u)}),Be(o,{resource:e,resourceFolderName:t})},Uo=async()=>{console.log(),await S(()=>Pt("@refinedev/inferencer"),"Checking if '@refinedev/inferencer' package is installed...")||(console.log("\u{1F4E6} Installing '@refinedev/inferencer' package..."),await Y(["@refinedev/inferencer@latest"],"add","\u2705 '@refinedev/inferencer' package installed successfully!"))};var Bo=e=>{let t=h(),{path:r}=le(t);return e.command("create-resource").allowExcessArguments(!0).description('Create a new resource files (deprecated, please use "add resource" command)').option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(Lo)},Lo=async(e,t)=>{G(e,t.args)},Ut=Bo;var Yt=require("commander");var Xt=i(require("conf")),qt=i(require("chalk"));var Bt=i(require("dotenv")),Lt={};Bt.config({processEnv:Lt});var Wo={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},zo=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,o]of Object.entries(Wo))if(o.test(e)){t=r;break}return t},Ie=e=>process.env[e]||Lt[e],N={NODE_ENV:zo(),REFINE_NO_TELEMETRY:Ie("REFINE_NO_TELEMETRY")||"false",UPDATE_NOTIFIER_IS_DISABLED:Ie("UPDATE_NOTIFIER_IS_DISABLED")||"false",UPDATE_NOTIFIER_CACHE_TTL:Ie("UPDATE_NOTIFIER_CACHE_TTL")||1e3*60*60*24,REFINE_DEVTOOLS_PORT:Ie("REFINE_DEVTOOLS_PORT")};var Wt=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var Xo="refine-update-notifier",V=new Xt.default({projectName:Xo,defaults:{key:"",lastUpdated:0,packages:[]}}),Z=async()=>{if(Ko())return;let e=await Jo();if(e!==null){if(e){zt();return}qo(),zt()}},qo=async()=>{let e=V.get("packages");e!=null&&e.length&&(await we({data:e}),console.log(`
`))},Jo=async()=>{let e=await Yo(),t=Ho();return e===null?null:!!(t||!e)},zt=async()=>{try{let e=await ce();return V.set("packages",e),V.set("lastUpdated",Date.now()),V.set("key",await Jt()),e}catch{return V.set("packages",[]),V.set("lastUpdated",Date.now()),V.set("key",""),null}},Ho=()=>{let e=V.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,o=Number(N.UPDATE_NOTIFIER_CACHE_TTL);return r>=o},Yo=async()=>{let e=V.get("key"),t=await Jt();return t===null?null:e===t},Jt=async()=>{let e=await X();if(!e)return console.error(qt.default.red("Something went wrong when trying to get installed `Refine` packages.")),null;let t=e.map(o=>`${o.name}@${o.version}`);return Wt(t.toString())},Ko=()=>N.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";function z(e){if(process.platform==="win32")try{return require.resolve(`.bin/${e}.exe`)}catch{}return require.resolve(`.bin/${e}`)}var T={["react-scripts"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>z("react-scripts")},["vite"]:{getDev:e=>["dev",...e],getStart:e=>["preview",...e],getBuild:e=>["build",...e],getBin:()=>z("vite")},["nextjs"]:{getDev:e=>["dev",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>z("next")},["remix"]:{getDev:e=>["dev",...e],getStart:e=>(e==null?void 0:e.length)?e:(console.log(),console.warn("\u{1F6A8} Remix requires a path to the entry file. Please provide it as an argument to `refine start` command in package.json scripts"),console.warn("Refine will use `./build/index.js` as default"),console.warn("Example: `refine start ./build/index.js`"),console.log(),["./build/index.js"]),getBuild:e=>["build",...e],getBin:e=>z(e==="start"?"remix-serve":"remix")},["remix-vite"]:{getDev:e=>["vite:dev",...e],getStart:e=>(e==null?void 0:e.length)?e:(console.log(),console.warn("\u{1F6A8} Remix requires a path to the entry file. Please provide it as an argument to `refine start` command in package.json scripts"),console.warn("Refine will use `./build/server/index.js` as default"),console.warn("Example: `refine start ./build/server/index.js`"),console.log(),["./build/server/index.js"]),getBuild:e=>["vite:build",...e],getBin:e=>z(e==="start"?"remix-serve":"remix")},["remix-spa"]:{getDev:e=>["vite:dev",...e],getStart:e=>["preview",...e],getBuild:e=>["vite:build",...e],getBin:e=>z(e==="start"?"vite":"remix")},["craco"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>z("craco")},["parcel"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>z("parcel")},["unknown"]:{getDev:e=>[...e],getStart:e=>[...e],getBuild:e=>[...e],getBin:()=>"unknown"}};var Ht=i(require("execa")),M=async(e,t,r={})=>{var n,s;if(e==="unknown"){let a=Object.values(w).filter(p=>p!=="unknown").join(", ");console.error(`We couldn't find executable for your project. Supported executables are ${a}.
Please use your own script directly. If you think this is an issue, please report it at: https://github.com/refinedev/refine/issues`);return}let o=(0,Ht.default)(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",REFINE_NO_TELEMETRY:N.REFINE_NO_TELEMETRY,...r,...process.env}});return(n=o.stdout)==null||n.pipe(process.stdout),(s=o.stderr)==null||s.pipe(process.stderr),await o};var Q=e=>{let t=h(),r=[];switch(e){case"dev":r=T[t].getDev([""]);break;case"start":r=T[t].getStart([""]);break;case"build":r=T[t].getBuild([""]);break}if(e==="start")switch(t){case"remix":case"remix-vite":t="remix-serve";break;case"remix-spa":t="vite";break}return`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`},ee=()=>`Platform to run command on. 
ex: ${Object.values(w).join(", ")}`;var Go=e=>e.command("start").description(Q("start")).allowUnknownOption(!0).addOption(new Yt.Option("-p, --platform <platform>",ee()).choices(Object.values(w).filter(t=>t!=="unknown"))).argument("[args...]").action(Zo),Zo=async(e,{platform:t})=>{let r=h(t),o=T[r].getBin("start"),n=T[r].getStart(e);await Z(),M(o,n)},We=Go;var He=require("commander");var Qt=require("@refinedev/devtools-server");var Kt=i(require("execa"));var Ee=require("prettier"),ze=async e=>{try{let t=await(0,Ee.resolveConfig)(process.cwd());return(0,Ee.format)(e,{...t??{},parser:"typescript"})}catch{return e}};var Gt=async()=>{let e=require.resolve(".bin/jscodeshift"),{stderr:t}=Kt.default.sync(e,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/add-devtools-component.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);t&&console.log(t)};var Zt=()=>{let t=$().scripts||{};return{dev:((t==null?void 0:t.dev)||"").match(/refine dev(\s|$|;){1}/)!==null}};var er=i(require("boxen")),tr=i(require("cardinal")),qe=i(require("chalk")),rr=require("commander"),or=i(require("dedent")),Re=i(require("semver")),Qo=["start","init"],en="start",nr="4.42.0",tn=e=>e.command("devtools").description("Start or install Refine Devtools server; it starts on port 5001.").addArgument(new rr.Argument("[command]","devtools related commands").choices(Qo).default(en)).addHelpText("after",`
Commands:
    start     Start Refine Devtools server
    init      Install Refine Devtools client and adds it to your project
`).action(rn),rn=async e=>{switch(e){case"start":Je();return;case"init":on();return}},on=async()=>{var n;let e=await Xe();if(await S(he,"Checking if devtools is installed...")){console.log("\u{1F389} Refine Devtools is already installed");return}if(e&&await sr({pkg:e}))return;console.log("\u{1F331} Installing Refine Devtools...");let r=["@refinedev/devtools@latest"];if((!e||Re.default.lt(e.version,nr))&&(r.push("@refinedev/core@latest"),console.log("\u{1F331} Refine core package is being updated for devtools...")),await Fe(r),console.log(""),console.log(""),console.log("\u{1F331} Adding devtools component to your project...."),await Gt(),console.log("\u2705 Refine Devtools package and components added to your project"),r.includes("@refinedev/core@latest")){let s=await Xe();console.log(`\u2705 Refine core package updated from ${(e==null?void 0:e.version)??"unknown"} to ${(s==null?void 0:s.version)??"unknown"}`),console.log(`   Changelog: ${qe.default.underline.blueBright(`https://c.refine.dev/core#${(e==null?void 0:e.version.replaceAll(".",""))??""}`)}`)}console.log("");let{dev:o}=Zt();if(o){console.log(`\u{1F64C} You're good to go. "npm run dev" will automatically starts the devtools server.`),console.log('\u{1F449} You can also start the devtools server manually by running "refine devtools start"');return}if(!o){let s=(n=$().scripts)==null?void 0:n.dev;console.log('\u{1F6A8} Your have modified the "dev" script in your package.json. Because of that, "npm run dev" will not start the devtools server automatically.'),console.log('\u{1F449} You can append "refine devtools" to "dev" script'),console.log('\u{1F449} You can start the devtools server manually by running "refine devtools"'),console.log(""),console.log((0,er.default)(tr.default.highlight((0,or.default)(`
                {
                    "scripts": {
                        "dev": "${s} & refine devtools",
                        "refine": "refine"
                    }
                }  
        `)),{padding:1,title:"package.json",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"}))}},Je=async({exitOnError:e=!0}={})=>{let t=await Xe();if(t){if(await sr({pkg:t}))return;if(Re.default.lt(t.version,nr)){console.log(`\u{1F6A8} You're using an old version of Refine(${t.version}). Refine version should be @4.42.0 or higher to use devtools.`);let r=await k();console.log(`\u{1F449} You can update @refinedev/core package by running "${r.name} run refine update"`);return}}(0,Qt.server)({onError:()=>{e&&process.exit(1)}}).catch(r=>{})},Xe=async()=>{let e=await se(),t=e==null?void 0:e.find(r=>r.name==="@refinedev/core"||r.name==="@pankod/refine-core");if(t)return t},sr=async({pkg:e})=>e.name==="@pankod/refine-core"||Re.default.lt(e.version,"4.0.0")?(console.log(`\u{1F6A8} You're using an old version of Refine(${e.version}). Refine version should be @4.42.0 or higher to use devtools.`),console.log("You can follow migration guide to update Refine."),console.log(qe.default.blue("https://refine.dev/docs/migration-guide/3x-to-4x/")),!0):!1,ir=tn;var nn=e=>e.command("dev").description(Q("dev")).allowUnknownOption(!0).addOption(new He.Option("-p, --platform <platform>",ee()).choices(Object.values(w).filter(t=>t!=="unknown"))).addOption(new He.Option("-d, --devtools <devtools>","Start Refine Devtools server").default("true","true if devtools is installed")).argument("[args...]").action(sn),sn=async(e,{platform:t,...r})=>{let o=h(t),n=T[o].getBin("dev"),s=T[o].getDev(e);await Z();let a=Ot(o),p=await he(),f=r.devtools==="false"?!1:p;f&&Je({exitOnError:!1});let c=f&&N.REFINE_DEVTOOLS_PORT?{[a]:N.REFINE_DEVTOOLS_PORT}:void 0;M(n,s,c)},Ye=nn;var ar=require("commander");var an=e=>e.command("build").description(Q("build")).allowUnknownOption(!0).addOption(new ar.Option("-p, --platform <platform>",ee()).choices(Object.values(w).filter(t=>t!=="unknown"))).argument("[args...]").action(cn),cn=async(e,{platform:t})=>{let r=h(t),o=T[r].getBin("build"),n=T[r].getBuild(e);await Z();try{await M(o,n)}catch{process.exit(1)}},Ke=an;var Ge=i(require("chalk"));var ln=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(pn),pn=async e=>{let[t,...r]=e,o=ge();if(!t){console.log(`Available via ${Ge.default.blue("`refine run`")}:
`);for(let[a,p]of Object.entries(o))console.log(`  ${a}`),console.log(`    ${Ge.default.dim(p)}`),console.log();return}if(!Object.keys(o).includes(t)){let a=`${process.cwd()}/node_modules/.bin/${t}`;M(a,r);return}let s=await k();M(s.name,["run",t,...r])},Ze=ln;var rt=i(require("path")),q=i(require("chalk")),me=i(require("inquirer")),Dr=i(require("inquirer-autocomplete-prompt")),U=require("fs-extra");var et=i(require("path"));var fr=i(require("path"));var Qe={};Co(Qe,{PackageManagerTypes:()=>Dt,ProjectTypes:()=>w,UIFrameworks:()=>Ue,appendAfterImports:()=>mr,getFileContent:()=>Te,getImports:()=>te,getNameChangeInImport:()=>lr});var mn=/import(?:\s+(type))?\s*(?:([^\s\{\},]+)\s*(?:,\s*)?)?(\{[^}]+\})?\s*(?:\*\s*as\s+([^\s\{\}]+)\s*)?from\s*['"]([^'"]+)['"];?/g,dn=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,te=e=>{let t=e.matchAll(mn),r=[];for(let o of t){let[n,s,a,p,f,c]=o;r.push({isType:s==="type",statement:n,importPath:c,...a&&{defaultImport:a},...p&&{namedImports:p},...f&&{namespaceImport:f}})}return r==null?void 0:r.filter(Boolean)},lr=e=>{let t=e.matchAll(dn),r=[];for(let o of t){let[n,s,a,p,f]=o;r.push({statement:n,fromName:s.trim(),toName:p.trim(),afterCharacter:f})}return r},un=(e,t)=>{var s;let r=e.substring(0,e.indexOf(t.statement)),o=te(r).pop();return o?r.substring(r.indexOf(o==null?void 0:o.statement)+((s=o==null?void 0:o.statement)==null?void 0:s.length)):r},fn=(e,t)=>!!(t?un(e,t):"").trim(),cr=["react","@refinedev/core","@refinedev/"],pr=e=>{var d;let t=e,r=te(e),o=r.filter(l=>!l.isType),n=r.filter(l=>l.isType),s=[],a=[];n.forEach(l=>{t=t.replace(`${l.statement}
`,"")}),o.forEach(l=>{fn(t,l)?s.push(l):a.push(l)});let p=t.indexOf((d=a==null?void 0:a[0])==null?void 0:d.statement);a.forEach(l=>{t=t.replace(l.statement,"")});let f=a.reduce((l,m)=>{let{importPath:g}=m;return l[g]?l[g].push(m):l[g]=[m],l},{}),v=[...Object.entries(f).map(([l,m])=>{let g=m.find(I=>I.defaultImport),y=m.find(I=>I.namespaceImport),P=m.filter(I=>I.namedImports).map(I=>(I.namedImports??"").replace(/{|}/g,"").trim().split(",").map(je=>je.trim()).filter(Boolean).join(", ")).join(", "),A="";return y&&(A+=`${y.statement}
`),(g||P)&&(g&&P?A+=`import ${g.defaultImport}, { ${P} } from "${m[0].importPath}";
`:g?A+=`import ${g.defaultImport} from "${m[0].importPath}";
`:A+=`import { ${P} } from "${m[0].importPath}";
`),[l,A]})].sort(([l],[m])=>{let g=cr.findIndex(P=>l.includes(P)),y=cr.findIndex(P=>m.includes(P));return g===y?l.localeCompare(m):g===-1?1:y===-1?-1:g-y}).map(([,l])=>l).join(""),x=[...n.map(l=>l.statement),""].join(`
`);return t=t.substring(0,p)+v+x+t.substring(p),t};var mr=(e,t)=>{let r=te(e),o=r[r.length-1],n=o?e.indexOf(o.statement):e.length-1;return`${e.slice(0,n+(o==null?void 0:o.statement.length))}
${t}
${e.slice(n+(o==null?void 0:o.statement.length))}`};var dr=require("fs-extra"),ur=require("path");function Te(e){if(this!=null&&this.absolutePackageDir)try{return(0,dr.readFileSync)((0,ur.join)(this.absolutePackageDir,e)).toString()}catch{return}}var gr=require("module"),gn=gr.prototype.require,hr=(e,t)=>{gr.prototype.require=function(...r){return r[0]==="@refinedev/cli"?{...Qe,getFileContent:o=>Te.call({absolutePackageDir:t?e:fr.default.join(process.cwd(),e)},o)}:gn.apply(this,r)}};var tt=async(e,t)=>{try{return hr(e,t),require(et.default.join(t?e:et.default.join(process.cwd(),e),"refine.config.js"))}catch{return}};var Er=i(require("dedent"));var C={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};var E=i(require("chalk"));var vr=i(require("chalk")),yr=i(require("cardinal")),wr=i(require("boxen")),hn=e=>{let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,o]=t.exec(e)??[];if(o){let n=o.trim(),s=e.replace(r||"","");return{title:n,code:s}}return{code:e}},Pr=e=>{let{title:t,code:r}=hn(e),o="";try{o=yr.default.highlight(r,{jsx:!0})}catch{o=r}return(0,wr.default)(o,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?vr.default.bold(t):void 0})};var xr=require("marked"),Ir=i(require("marked-terminal")),Ce=e=>(0,xr.marked)(e,{renderer:new Ir.default({code:Pr})});var Rr=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let o=t.filter(([,c])=>Object.values(C).filter(u=>u!==C.SUCCESS).includes(c)),n="success";switch(o.length){case 0:n="success";break;case t.length:n="error";break;default:n="warning";break}let s=c=>{let u=c==null?void 0:c.replace(process.cwd(),"");return u!=null&&u.startsWith("/")?u.slice(1):u!=null&&u.startsWith("./")?u.slice(2):u},a=()=>{switch(n){case"success":console.log(E.default.blueBright(`Successfully swizzled ${E.default.bold(e)}`));return;case"warning":console.log(E.default.yellowBright(`Swizzle completed with errors for ${E.default.bold(e)}`));return;case"error":console.log(E.default.redBright(`Swizzle failed for ${E.default.bold(e)}`));return;default:return}},p=()=>{let c=[];c.push(E.default.dim(`File${t.length>1?"s":""} created:`)),c.push(t.map(([u,v])=>v===C.SUCCESS?E.default.cyanBright.dim(` - ${s(u)}`):v===C.TARGET_ALREADY_EXISTS?E.default.cyanBright.dim(` - ${E.default.yellowBright.bold("[FILE_ALREADY_EXISTS] ")}${s(u)}`):v===C.SOURCE_PATH_NOT_A_FILE?E.default.cyanBright.dim(` - ${E.default.yellowBright.bold("[SOURCE NOT FOUND] ")}${s(u)}`):E.default.cyanBright.dim(` - ${E.default.yellowBright.bold(`[${v}]`)}${s(u)}`)).join(`
`)),console.log(c.join(`
`))},f=()=>{r&&n!=="error"&&console.log(Ce((0,Er.default)(`
${r}`)))};console.log(""),a(),p(),console.log(""),f()};var Tr=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};var Ar=i(require("boxen"));var Cr=()=>{let e;try{e=h()}catch{e=void 0}return Pe(e)};var kr=i(require("inquirer")),br=i(require("chalk"));var Sr=async e=>{await vn(e)?await Y(e):await yn(e)},vn=async e=>{let t=`This component requires following packages to be installed:
`.concat(e.map(o=>` - ${o}`).join(`
`)).concat(`
Do you want to install them?`),{installRequiredPackages:r}=await kr.default.prompt([{type:"confirm",name:"installRequiredPackages",default:!0,message:t}]);return r},yn=async e=>{let t=await k(),r=j[t.name].add.join(" "),o=e.join(" "),n=`${t.name} ${r} ${o}`;console.log(`
You can install them manually by running this command:`),console.log(br.default.bold.blueBright(n))};var wn=e=>e.command("swizzle").description(`Export a component or a function from ${q.default.bold("Refine")} packages to customize it in your project`).action(Pn),Nr=e=>(t,r="")=>e.filter(n=>{var s;return n.label.toLowerCase().includes(r.toLowerCase())||((s=n.group)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))}).flatMap((n,s,a)=>{var c;return[...(n==null?void 0:n.group)&&((c=a[s-1])==null?void 0:c.group)!==n.group&&n.group?[new me.default.Separator(q.default.bold(n.group))]:[],{name:` ${n.label}`,value:n!=null&&n.value?n.value:n}]}),Pn=async e=>{var u,v,x;me.default.registerPrompt("autocomplete",Dr.default);let t=await se(),r=[];if(await Promise.all(t.map(async d=>{let l=await gt(d.path),m=r.findIndex(g=>g.name===d.name)===-1;l&&m&&r.push(d)})),r.length===0){console.log("No Refine packages found with swizzle configuration.");return}console.log(`${(0,Ar.default)(`Found ${q.default.blueBright(r.length)} installed ${q.default.blueBright.bold("Refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let o=await Promise.all(r.map(async d=>{let l=await tt(d.path,!0)??await tt(d.path,!1)??{swizzle:{items:[]}};return{...d,config:l}})),{selectedPackage:n}=await me.default.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:Nr(o.sort((d,l)=>{var m,g;return(((m=d.config)==null?void 0:m.group)??"").localeCompare(((g=l.config)==null?void 0:g.group)??"")}).map(d=>{var l,m;return{label:((l=d.config)==null?void 0:l.name)??d.name,value:d,group:(m=d.config)==null?void 0:m.group}}))}]),{swizzle:{items:s,transform:a}}=n.config,p;if(s.length===0){console.log(`No swizzle items found for ${q.default.bold(((u=n.config)==null?void 0:u.name)??n.name)}`);return}if(s.length===1?p=s[0]:s.length>1&&(p=(await me.default.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:Nr(s.sort((l,m)=>l.group.localeCompare(m.group)))({},"")}])).selectedComponent),!p){console.log(`No swizzle items selected for ${q.default.bold(((v=n.config)==null?void 0:v.name)??n.name)}`);return}let f=Cr(),c=await Promise.all(p.files.map(async d=>{var l;try{let m=d.src?rt.default.join(n.path,d.src):void 0,g=d.dest?rt.default.join(process.cwd(),f,d.dest):void 0;if(!m)return console.log("No src path found for file",d),["",C.SOURCE_PATH_NOT_FOUND];if(!g)return console.log("No destination path found for file",d),["",C.TARGET_PATH_NOT_FOUND];if(!await(0,U.pathExists)(m))return[g,C.SOURCE_PATH_NOT_A_FILE];let P=await(0,U.readFile)(m,"utf-8");if(await(0,U.pathExists)(g))return[g,C.TARGET_ALREADY_EXISTS];await(0,U.ensureFile)(g);let I=Tr(P),B=((l=d.transform)==null?void 0:l.call(d,I))??I,je=(a==null?void 0:a(B,m,g))??B,wo=pr(je),Po=await ze(wo);return await(0,U.writeFile)(g,Po),[g,C.SUCCESS]}catch{return["",C.UNKNOWN_ERROR]}}));c.length>0&&(Rr({files:c,label:p.label,message:p.message}),(x=p==null?void 0:p.requiredPackages)!=null&&x.length&&await Sr(p.requiredPackages))},Or=wn;var Vr=i(require("inquirer")),Mr=i(require("center-align")),Ur=require("commander"),Br=i(require("@npmcli/package-json"));var re=i(require("inquirer")),ot=i(require("semver-diff")),ke=i(require("chalk"));var jr=e=>{let t=e.filter((o,n)=>e.indexOf(o)!==n),r=new Set(t);return Array.from(r)};var _r=async e=>{let t=In(e);if(!t){console.log("All `Refine` packages are up to date. \u{1F389}");return}let r=En(t),o=await re.default.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:xn}]);if(o.packages.length>0){let n={};return o.packages.forEach(s=>{let{name:a,version:p}=Ve(s);n[a]=p??"latest"}),n}return null},xn=e=>{let r=e.map(n=>Ve(n)).map(n=>n.name),o=jr(r);return o.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${o.join(", ")}`:!0},In=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let o=r.current,n=(0,ot.default)(o,r.wanted),s=(0,ot.default)(o,r.latest);if(n===s&&s){t[s].push({name:r.name,from:o,to:r.latest});return}n&&t[n].push({name:r.name,from:o,to:r.wanted}),s&&t[s].push({name:r.name,from:o,to:r.latest})}),t},En=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(c=>{c.forEach(u=>{u.name.length>t&&(t=u.name.length),u.from.length>r&&(r=u.from.length)})}),t+=2;let o=[],n="Package".padEnd(t),s="From".padEnd(r),p=`
   ${n} ${s}${"To".padStart(r)}`;o.push(new re.default.Separator(p)),e.patch.length>0&&(o.push(new re.default.Separator(ke.default.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(c=>{o.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ^${c.to}`,value:`${c.name}@^${c.to}`})})),e.minor.length>0&&(o.push(new re.default.Separator(ke.default.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(c=>{o.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ^${c.to}`,value:`${c.name}@^${c.to}`})})),e.major.length>0&&(o.push(new re.default.Separator(ke.default.reset.bold.blue(`
Major Updates`))),e.major.forEach(c=>{o.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ^${c.to}`,value:`${c.name}@^${c.to}`})}));let f=o.length+6;return{choices:o,pageSize:f}};var J=i(require("chalk"));var Rn=e=>e.command("update").description("Interactively select and update all `Refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new Ur.Option("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `Refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(Tn),Tn=async e=>{let{tag:t,dryRun:r,all:o}=e,n=await S(ce,"Checking for updates...");if(!(n!=null&&n.length)){console.log("All `Refine` packages are up to date \u{1F389}");return}let s=null;if(o){let c=await nt(t,n);if(!c)return;if(r){$r(c);return}Fr(c);return}let{table:a,width:p}=ve(n)??"";console.log((0,Mr.default)("Available Updates",p)),console.log(a),console.log(`- ${J.default.yellow(J.default.bold("Current"))}: The version of the package that is currently installed`),console.log(`- ${J.default.yellow(J.default.bold("Wanted"))}: The maximum version of the package that satisfies the semver range specified in \`package.json\``),console.log(`- ${J.default.yellow(J.default.bold("Latest"))}: The latest version of the package available on npm`),console.log();let{installationType:f}=await Vr.default.prompt([{type:"list",name:"installationType",message:"Do you want to update all Refine packages for minor and patch versions?",choices:[{name:'Update all packages to latest "minor" version without any breaking changes.',value:"minor"},{name:"Update all packages to the latest version that satisfies the semver(`wanted`) range specified in `package.json`",value:"wanted"},{name:'Use interactive mode. Choose this option for "major" version updates.',value:"interactive"}]}]);f==="interactive"&&(s=await _r(n)),f==="wanted"&&(s=await nt("wanted",n)),f==="minor"&&(s=await nt("minor",n)),s&&(r?$r(s):Fr(s))},nt=async(e,t)=>{if(e==="wanted"&&t.every(n=>n.current===n.wanted))return console.log(),console.log("\u2705 All `Refine` packages are already at the wanted version"),null;console.log();let r={};for(let o of t){let n=o.latest;e==="minor"&&(n=`^${await S(()=>St(o.name,o.wanted),`Checking for the latest minor version of ${o.name}`)}`),e==="wanted"&&(n=bt(o.name,o.wanted)),e==="latest"&&(n=`^${o.latest}`),e==="next"&&(n="next"),r[o.name]=n}return r},$r=async e=>{let t=await k(),r=j[t.name].add,o="";for(let[n,s]of Object.entries(e))o+=`${n}@${s} `;console.log(),console.log(`${t.name} ${r.join(" ")} ${o}`)},Fr=async e=>{console.log("Updating `Refine` packages...");let t=await Br.default.load(process.cwd());t.update({dependencies:{...t.content.dependencies??{},...e??{}}}),await t.save(),Y([],"all")},Lr=Rn;var Wr=i(require("envinfo")),zr=i(require("ora")),Cn=e=>e.command("whoami").description("View the details of the development environment").action(kn),kn=async()=>{let e=(0,zr.default)("Loading environment details...").start(),t=await Wr.default.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),o=(await X()||[]).map(n=>` - ${n.name}: ${n.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(o)},Xr=Cn;var ue=i(require("chalk")),fe=i(require("inquirer"));var Gr=i(require("inquirer"));var qr=i(require("execa")),be=async e=>{let{incompatiblePackages:t,integrationName:r,requiredPackages:o,transformerFileName:n}=e;if(yt(t))return;await vt(o),console.log(`\u{1F680} Setting up ${r}...`);let s=require.resolve(".bin/jscodeshift"),{stderr:a}=qr.default.sync(s,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/integrations/${n}.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);a&&console.log(a),console.log(`\u{1F389} ${r} setup completed!`)};var Se=i(require("chalk")),Ne=e=>{let{id:t,title:r,description:o,disabled:n}=e;return n?{value:t,name:`${Se.default.gray(r)}`,disabled:Se.default.redBright(n)}:{value:t,name:`${Se.default.blueBright(r)} - ${o}`}};var Jr="ant-design",bn="Ant Design",Sn=["@remix-run/react","next"],Nn=["antd","@refinedev/antd"],Dn="ant-design",Hr={id:Jr,getChoice:e=>{let t="Ant Design",r="Setup Ant Design with Refine",o;return["nextjs","remix","remix-vite","remix-spa"].includes(e)&&(o="Automatic setup only available Vite for now. See the documentation for manual installation: https://refine.dev/docs/ui-integrations/ant-design/introduction/#installation"),Ne({id:Jr,title:t,description:r,disabled:o})},runTransformer:async()=>await be({incompatiblePackages:Sn,integrationName:bn,requiredPackages:Nn,transformerFileName:Dn})};var Yr="react-router",An="React Router",On=["@remix-run/react","next"],jn=["react-router","@refinedev/react-router"],_n="react-router",Kr={id:Yr,getChoice:e=>{let t="React Router",r="Setup routing with React Router",o;return e==="nextjs"&&(o="Can't be used with Next.js. https://nextjs.org/docs/app/building-your-application/routing"),(e==="remix"||e==="remix-vite"||e==="remix-spa")&&(o="Can't be used with Remix. https://remix.run/docs/en/main/discussion/routes"),Ne({id:Yr,title:t,description:r,disabled:o})},runTransformer:async()=>await be({incompatiblePackages:On,integrationName:An,requiredPackages:jn,transformerFileName:_n})};var H=[Hr,Kr];var st=()=>{let e=h(),t=H.map(r=>r.getChoice(e));return t.every(r=>r.disabled)?[{value:"none",name:"No integration available for this project type."},...t]:t},Zr=async()=>await Gr.default.prompt([{type:"list",name:"id",message:"Which integration do you want to add?",choices:st(),default:"none"}]);var Qr=i(require("chalk")),eo=i(require("inquirer"));var b=require("fs-extra"),D=require("path");var oe=[{id:"auth",title:"Auth provider",description:"Manage user authentication and authorization",fileName:"auth-provider.tsx",templateFileName:"demo-auth-provider.tsx.template"},{id:"live",title:"Live provider",description:"Enable real-time updates and synchronization",fileName:"live-provider.tsx",templateFileName:"demo-live-provider.tsx.template"},{id:"data",title:"Data provider",description:"Communicate with your API",fileName:"data-provider.tsx",templateFileName:"demo-data-provider.tsx.template"},{id:"access-control",title:"Access Control",description:"Manage user permissions & roles",fileName:"access-control-provider.tsx",templateFileName:"demo-access-control-provider.tsx.template"},{id:"notification",title:"Notification provider",description:"Display in-app alerts and messages",fileName:"notification-provider.tsx",templateFileName:"demo-notification-provider.tsx.template"},{id:"i18n",title:"I18n provider",description:"Support multiple languages and locales",fileName:"i18n-provider.tsx",templateFileName:"demo-i18n-provider.tsx.template"},{id:"audit-log",title:"Audit Log provider",description:"Display audit logs for your resources",fileName:"audit-log-provider.tsx",templateFileName:"demo-audit-log-provider.tsx.template"}];var $n=`${__dirname}/../templates/provider`,it=`${__dirname}/../templates/assets`,de=(e,t)=>{e.forEach(r=>{let{fileName:o,templateFileName:n}=Fn(r),s=Pe(h()),a=t??at(),p=(0,D.join)(a,o),f=(0,D.join)(process.cwd(),a,o),c=(0,D.join)(process.cwd(),s);if((0,b.pathExistsSync)(f)){console.error(`\u274C Provider (${p}) already exist!`);return}(0,b.mkdirSync)(a,{recursive:!0}),(0,b.copySync)(`${$n}/${n}`,f),console.log(`\u{1F389} Provider (${p}) created successfully!`);let u=[],v=[];if((0,b.pathExistsSync)(`${it}/${r}`))try{(0,b.readdirSync)(`${it}/${r}`,{recursive:!0,withFileTypes:!0}).forEach(x=>{if(!x.isDirectory()){let d=(0,D.join)(x.path,x.name),l=(0,D.join)(c,(0,D.relative)((0,D.join)(it,r),x.path),x.name),m=(0,D.join)(s,(0,D.relative)(c,l));if((0,b.existsSync)(l))v.push(m);else try{(0,b.copySync)(d,l),u.push(m)}catch{v.push(m)}}})}catch{}u.length&&console.log(`\u{1F389} Created additional assets: ${u.join(", ")}`),v.length&&console.error(`\u274C Failed to create assets: ${v.join(", ")}`)})},Fn=e=>{let t=oe.find(r=>r.id===e);if(!t)throw new Error(`Invalid provider: ${e}`);return t},at=()=>{let e=h(),{path:t}=_t(e);return t};var ct=()=>oe.map(e=>{let{id:t,title:r,description:o}=e;return{value:t,name:`${Qr.default.blueBright(r)} - ${o}`}}),to=async()=>await eo.default.prompt([{type:"checkbox",name:"providers",message:"Which providers do you want to add?",choices:ct()},{type:"input",name:"providersPath",message:"Where do you want to generate the providers?",default:at()}]);var ro=(e,t)=>t.map(r=>({...r,name:` . ${r.name}`,value:{group:e,component:r.value}})),oo=async()=>await fe.default.prompt([{type:"list",name:"component",message:"What do you want to add?",choices:[new fe.default.Separator(ue.default.bold("Provider")),...ro("provider",ct()),new fe.default.Separator(ue.default.bold("Integration")),...ro("integration",st()),new fe.default.Separator(ue.default.bold("Resource")),{name:ue.default.blueBright(" .  Add new resource"),value:{group:"resource",component:"resource"}}],pageSize:25}]);var De=require("commander");var Vn=async e=>{let t=e;t||(t=(await Zr()).id);let r=H.find(o=>o.id===t);r&&await r.runTransformer()},no=new De.Command("integration").addArgument(new De.Argument("[name]","Name of the integration").choices(H.map(e=>e.id))).action(Vn);var Ae=require("commander");var Mn=async(e,t)=>{if(!e.length){let{providers:r,providersPath:o}=await to();return de(r,o)}de(e,t.path)},so=new Ae.Command("provider").addArgument(new Ae.Argument("[providers...]","Create provider(s)").choices(oe.map(e=>e.id)).default([])).option("-p, --path [path]","Path to generate providers").action(Mn);var Oe=require("commander");var Un=async(e,t,r)=>{G({actions:t==null?void 0:t.actions,path:r.optsWithGlobals().path},e)},io=new Oe.Command("resource").addArgument(new Oe.Argument("[resources...]","Create new resource(s)")).option("-p, --path [path]","Path to generated resource files").option("-a, --actions [actions]","Only generate the specified resource actions. (ex: list,create,edit,show)","list,create,edit,show").action(Un);var Bn=e=>e.command("add").description("Add new resources, providers, or integrations").allowExcessArguments(!1).action(Ln).addCommand(io).addCommand(so).addCommand(no),Ln=async()=>{let{component:e}=await oo();if(e.group==="provider"&&de([e.component]),e.group==="integration"){let t=H.find(r=>r.id===e.component);await(t==null?void 0:t.runTransformer())}e.group==="resource"&&await G({},[])},ao=Bn;var co=i(require("envinfo")),lo=i(require("os")),Wn=()=>{let e=lo.default.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},po=async()=>{let[e,t]=await co.default.helpers.getOSInfo();return{name:Wn(),version:t}};var mo=i(require("node-fetch")),zn=async()=>{let e=await po();return{nodeEnv:N.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await X()||[],projectFramework:h(),projectId:ht()}},uo=async()=>{if(N.REFINE_NO_TELEMETRY!=="true")try{let e=await zn();await(0,mo.default)("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};var fo=i(require("gray-matter")),go=i(require("boxen"));var Xn="https://raw.githubusercontent.com/refinedev/refine/main/packages/cli/ANNOUNCEMENTS.md",lt="---announcement",qn=e=>e.split(lt).slice(1).map(r=>`${lt}${r}`),Jn=e=>{let t=e.replace(lt,"---"),r=(0,fo.default)(t),o=(r.content.length===0?t.replace(/---/g,""):r.content.replace(/---/g,"")).trim();return{...r.data,content:o}},Hn=async()=>{try{let e=await fetch(Xn).then(r=>r.text()).catch(()=>"");return qn(e).map(r=>Jn(r))}catch{return[]}},ho=async()=>{let t=(await Hn()).filter(o=>!o.hidden);if(t.length===0)return;let r=t.map(o=>{let n=t.length>1?"\u2014 ":"",s=Ce(o.content);return`${n}${s}`}).join("").trim();console.log((0,go.default)(r,{padding:1,margin:0,borderStyle:"round",borderColor:"blueBright",titleAlignment:"left"}))};var Yn="1.0.0",Kn=()=>{let e=new vo.Command;e.version(`@refinedev/cli@${Yn}`,"-v, --version","Output the current version.").description(yo.default.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),Or(e),Ut(e),Lr(e),Ye(e),Ke(e),We(e),Ze(e),Nt(e),Xr(e),ir(e),ao(e),e.hook("preAction",async t=>{t.args.includes("dev")&&await ho()}),e.hook("postAction",t=>{let r=t.args[0];["run"].includes(r)||uo()}),e.parse(process.argv),process.argv.slice(2).length||e.outputHelp()};Kn();
//# sourceMappingURL=cli.cjs.map